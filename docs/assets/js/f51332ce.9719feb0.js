"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[720],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>b});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),l=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,s=e.originalType,i=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),p=l(n),h=o,b=p["".concat(i,".").concat(h)]||p[h]||u[h]||s;return n?r.createElement(b,a(a({ref:t},d),{},{components:n})):r.createElement(b,a({ref:t},d))}));function b(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var s=n.length,a=new Array(s);a[0]=h;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c[p]="string"==typeof e?e:o,a[1]=c;for(var l=2;l<s;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9943:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var r=n(87462),o=(n(67294),n(3905));const s={},a="WebSockets in docker",c={unversionedId:"WebAPI/web-sockets/WebSockets in docker",id:"WebAPI/web-sockets/WebSockets in docker",title:"WebSockets in docker",description:"Using WebSockets is the most robust solution if you want players to be in perfect sync with each other and it\u2019s what most AAA multiplayer games use. In a WebSockets connection, data \u2018frames\u2019 can be sent at any time by the player or the server whenever there\u2019s something to update.",source:"@site/docs/WebAPI/web-sockets/WebSockets in docker.md",sourceDirName:"WebAPI/web-sockets",slug:"/WebAPI/web-sockets/WebSockets in docker",permalink:"/notebook/docs/WebAPI/web-sockets/WebSockets in docker",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/WebAPI/web-sockets/WebSockets in docker.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Can't connect to WSS/SSL websocket server with a self-signed certificate",permalink:"/notebook/docs/WebAPI/web-sockets/Cant connect to WSS SSL websocket server with a self-signed certificate"},next:{title:"exploring-the-web-speech-api",permalink:"/notebook/docs/WebAPI/web-speech-api/exploring-the-web-speech-api"}},i={},l=[{value:"Create a server",id:"create-a-server",level:2},{value:"solsson/websocat",id:"solssonwebsocat",level:2},{value:"Resources",id:"resources",level:2}],d={toc:l};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"websockets-in-docker"},"WebSockets in docker"),(0,o.kt)("p",null,"Using WebSockets is the most robust solution if you want players to be in perfect sync with each other and it\u2019s what most AAA multiplayer games use. In a WebSockets connection, data \u2018frames\u2019 can be sent at any time by the player or the server whenever there\u2019s something to update."),(0,o.kt)("p",null,"A WebSockets connection is first established with a handshake between the player and the server which opens up a two-way stream of data to send and receive updates at any time, resulting in lower latency and better use of resources."),(0,o.kt)("p",null,"The Moonshot football stadium, where the Decentraland World Cup was held, is a perfect example of what\u2019s possible thanks to WebSockets. Using WebSockets was essential to keep the ball\u2019s position updated continuously and consistently for all players and spectators. Player positions were also synced via WebSockets to have less latency, their WebSocket-synced position was represented by an astronaut avatar to make them visible on all realms."),(0,o.kt)("h2",{id:"create-a-server"},"Create a server"),(0,o.kt)("p",null,"Instead of writing your own code for the server, you can use a generic broadcast server we prepared."),(0,o.kt)("p",null,"This pre-made WebSockets server broadcasts all the messages it receives to all other players that subscribe to the same room. "),(0,o.kt)("p",null,"For reference, you can find the code used by the server in this github repo: ",(0,o.kt)("inlineCode",{parentName:"p"},"github.com/decentraland-scenes/ws-broadcast")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ docker run -d -p 8080:8080 decentraland-scenes/ws-broadcast #docker pull solsson/websocat\n")),(0,o.kt)("p",null,"The broadcast service is now running on our server, but we need to expose its endpoints through a path, which we can do using nginx. Open nginx\u2019s configuration file on a console-based editor:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ nano /etc/nginx/sites-enabled/default\n")),(0,o.kt)("p",null,"We need the following to go in the second server object definition, which refers to the secure port 443."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"location /broadcast {\n    proxy_pass http://127.0.0.1:8080;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"Upgrade\";\n    proxy_set_header Host $host;\n    add_header 'Access-Control-Allow-Origin' '*';\n    add_header 'Access-Control-Allow-Methods' 'GET, OPTIONS';\n    #\n    #  Extra headers needed for certain browsers\n    #\n    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,if-range';\n\n    if ($request_method = 'OPTIONS') {\n    #\n            # Tell client that this pre-flight info is valid for 20 days\n            #\n        add_header 'Access-Control-Max-Age' 1728000;\n        add_header 'Content-Type' 'text/plain; charset=utf-8';\n        add_header 'Content-Length' 0;\n        return 204;\n    }\n    if ($request_method = 'GET') {\n            add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range';\n    }\n}\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ systemctl reload nginx\n")),(0,o.kt)("p",null,"You can now connect a scene to the server via ",(0,o.kt)("inlineCode",{parentName:"p"},"wss://yourIPwithDashs.nip.io/broadcast"),","),(0,o.kt)("h2",{id:"solssonwebsocat"},"solsson/websocat"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ docker run -d -p 8080:8080 solsson/websocat\n")),(0,o.kt)("h2",{id:"resources"},"Resources"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/vi/websocat"},"https://github.com/vi/websocat")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/decentraland-scenes/ws-broadcast"},"https://github.com/decentraland-scenes/ws-broadcast"))))}p.isMDXComponent=!0}}]);