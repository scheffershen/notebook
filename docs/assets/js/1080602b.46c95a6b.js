"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[44924],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),c=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(o.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),u=c(a),m=r,h=u["".concat(o,".").concat(m)]||u[m]||p[m]||s;return a?n.createElement(h,l(l({ref:t},d),{},{components:a})):n.createElement(h,l({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,l=new Array(s);l[0]=m;var i={};for(var o in t)hasOwnProperty.call(t,o)&&(i[o]=t[o]);i.originalType=e,i[u]="string"==typeof e?e:r,l[1]=i;for(var c=2;c<s;c++)l[c]=a[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},39891:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var n=a(87462),r=(a(67294),a(3905));const s={},l="PluralSight Administering An Elasticsearch Cluster",i={unversionedId:"ElasticSearch/PluralSight Administering An Elasticsearch Cluster",id:"ElasticSearch/PluralSight Administering An Elasticsearch Cluster",title:"PluralSight Administering An Elasticsearch Cluster",description:"02-02 Installing Elasticsearch 2 on Ubuntu 14",source:"@site/docs/ElasticSearch/PluralSight Administering An Elasticsearch Cluster.md",sourceDirName:"ElasticSearch",slug:"/ElasticSearch/PluralSight Administering An Elasticsearch Cluster",permalink:"/notebook/docs/ElasticSearch/PluralSight Administering An Elasticsearch Cluster",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/ElasticSearch/PluralSight Administering An Elasticsearch Cluster.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"ElasticSearchIndexingCommand php",permalink:"/notebook/docs/ElasticSearch/PHP codes/ElasticSearchIndexingCommand-php"},next:{title:"auto-suggestion jQuery and Elasticsearch",permalink:"/notebook/docs/ElasticSearch/auto-suggestion jQuery and Elasticsearch"}},o={},c=[{value:"02-02 Installing Elasticsearch 2 on Ubuntu 14",id:"02-02-installing-elasticsearch-2-on-ubuntu-14",level:2},{value:"Elasticsearch Nodes",id:"elasticsearch-nodes",level:2},{value:"03_03-Server and Hardware Requirements",id:"03_03-server-and-hardware-requirements",level:2},{value:"Configuration: Swap",id:"configuration-swap",level:2},{value:"Configuration: MMap and File Descriptors",id:"configuration-mmap-and-file-descriptors",level:2},{value:"RAM/2 = heap",id:"ram2--heap",level:2},{value:"Heap: Sizing and Swappingedit",id:"heap-sizing-and-swappingedit",level:2},{value:"04-02 Creating the First Client Node",id:"04-02-creating-the-first-client-node",level:2},{value:"04_03-Creating the First Master Node",id:"04_03-creating-the-first-master-node",level:2},{value:"04_04-Creating the First Data Node",id:"04_04-creating-the-first-data-node",level:2}],d={toc:c};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"pluralsight-administering-an-elasticsearch-cluster"},"PluralSight Administering An Elasticsearch Cluster"),(0,r.kt)("h2",{id:"02-02-installing-elasticsearch-2-on-ubuntu-14"},"02-02 Installing Elasticsearch 2 on Ubuntu 14"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# cat /etc/os-release\n# cat /etc/hostname\n# add-apt-repository ppa:webupd8team/java\n# apt-get update\n# apt-get install oracle-java8-installer\n# java -version\n# wget https://download.elasticsearch.org/elasticsearch/release/org/elasticsearch/distribution/deb/elasticsearch/2.0.0-beta2/elasticsearch-2.0.0-beta2.deb\n# dpkg -i elasticsearch-2.0.0-beta2.deb\n# service elasticsearch start\n# update-rc.d elasticsearch defaults 95 10\n# curl http://localhost:9200 #invoke-webrequest http://localhost:9200\n# nano /etc/elasticsearch/elasticsearch.yaml\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'cluster.name: pluralsight\n\nnode.name: es01 #/etc/hostname\n\npath.data: "/volume/data"\npath.logs: "/var/logs/special_folder"\npath:plugins: "/volume/plugins"\n\nminimum_master_nodes: 2\n\n# Wait until at least 8 nodes present and start recovery when either 3 minutes passes or all 9 nodes are present and active\ngateway.recovery_after_nodes: 8\ngateway.expected_nodes: 9\ngateway.recover_after_time: 3m\n\n#List your nodes by host or by IP address, Should be setup on each node in the same way\ndiscovery.zen.ping.unicast.hosts: "host1", "host2"\ndiscovery.zen.ping.multicast.enabled: false\n\nnode.master: true\nnode.data: false\n\n# node.data: true\n# node.master: false\n# node.client: false\n\n# We don\'t want to allow data nodes to be queried\nhttp.enabled: false\n\n#remove swapfile\nbootstrap.mlockall: true\n')),(0,r.kt)("h2",{id:"elasticsearch-nodes"},"Elasticsearch Nodes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Data Node: ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Hard working since they pgysically house all the shards and data, "),(0,r.kt)("li",{parentName:"ul"},"Don't typically service query request"),(0,r.kt)("li",{parentName:"ul"},'Tend to have the "beefiest" resources'))),(0,r.kt)("li",{parentName:"ul"},"Client Node:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Gateway to the cluster"),(0,r.kt)("li",{parentName:"ul"},"Handles all query requests and directs them to data nodes"),(0,r.kt)("li",{parentName:"ul"},"They're important but don't need a lot of muscle"))),(0,r.kt)("li",{parentName:"ul"},"Manager Node:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Brains of the whole operation"),(0,r.kt)("li",{parentName:"ul"},'In charge of maintaining the "cluster state"'),(0,r.kt)("li",{parentName:"ul"},"It's the only node allowed to update the state"),(0,r.kt)("li",{parentName:"ul"},"Without a master the cluster won't function")))),(0,r.kt)("h2",{id:"03_03-server-and-hardware-requirements"},"03_03-Server and Hardware Requirements"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Vitual IP or Load Balancer"),(0,r.kt)("li",{parentName:"ul"},"2 client nodes (32Go RAM, 2 CPU cores, 20 GB disk space)"),(0,r.kt)("li",{parentName:"ul"},"3 manager nodes (32Go RAM, 2 CPU cores, 20 GB disk space)"),(0,r.kt)("li",{parentName:"ul"},"4 data nodes (64Go RAM, 4 core CPU, 4x1 TB SSD disk in RAID 0 )")),(0,r.kt)("h2",{id:"configuration-swap"},"Configuration: Swap"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Most systems come with a swap file configured"),(0,r.kt)("li",{parentName:"ul"},"Can harm performance drastically"),(0,r.kt)("li",{parentName:"ul"},"Consult OS docs and remove/swapfile"),(0,r.kt)("li",{parentName:"ul"},"Alternatively, modify elasticsearch.yml")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"bootstrap.mlockall: true\n")),(0,r.kt)("h2",{id:"configuration-mmap-and-file-descriptors"},"Configuration: MMap and File Descriptors"),(0,r.kt)("p",null,"File descriptiors: How many files can a process use?"),(0,r.kt)("p",null,"File Descriptors: 64,000\nMMap: unlimited"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ulimit -m\n")),(0,r.kt)("p",null,"/etc/security/limits.conf"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"*       soft    nofile  64000\n*       hard    nofile  64000\nroot    soft    nofile  64000\nroot    hard    nofile  64000\n")),(0,r.kt)("p",null,"/etc/pam.d/common-session"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"session required                        pam_permit.so\nsession required                        pam_limits.so\n")),(0,r.kt)("p",null,"/etc/pam.d/common-session-noninteractive"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"session required                        pam_permit.so\nsession required                        pam_limits.so\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ulimit -m\n")),(0,r.kt)("h2",{id:"ram2--heap"},"RAM/2 = heap"),(0,r.kt)("p",null,"/etc/environment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'ES_HEAP_SIZE="8g"\n')),(0,r.kt)("h2",{id:"heap-sizing-and-swappingedit"},"Heap: Sizing and Swappingedit"),(0,r.kt)("p",null,"The default installation of Elasticsearch is configured with a 1 GB heap. For just about every deployment, this number is usually too small. "),(0,r.kt)("p",null,"If you are using the default heap values, your cluster is probably configured incorrectly."),(0,r.kt)("p",null,"There are two ways to change the heap size in Elasticsearch. The easiest is to set an environment variable called ES_HEAP_SIZE. When the server process starts, it will read this environment variable and set the heap accordingly. As an example, you can set it via the command line as follows:"),(0,r.kt)("p",null,"/etc/environment"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'ES_HEAP_SIZE="512m"\n')),(0,r.kt)("p",null,"OR"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"export ES_HEAP_SIZE=2g\nnohup ./bin/elasticsearch > log_05_04_2018.log 2>&1 &\n")),(0,r.kt)("h2",{id:"04-02-creating-the-first-client-node"},"04-02 Creating the First Client Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'cluster.name: globomantics_kb_production\n\nnode.name: es-client-01 #/etc/hostname\n\nnode.data: false\nnode.master: false\nnode.client: true\n\nnetwork.host: \n\ndiscovery.zen.ping.multicast.enabled: false\ndiscovery.zen.ping.unicast.hosts: ["es-client-01", "es-client-02", "es-master-01","es-master-02","es-master-03","es-data-01","es-data-02","es-data-03"]\n')),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://infogerance-linux.net/2011/augmenter-le-max-open-files/"},"https://infogerance-linux.net/2011/augmenter-le-max-open-files/")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# ulimit -n\n# nano /etc/security/limits.conf\n\n# curl http://es-client-01:9200/_cluster/stats\n# cd /user/share/elasticsearch/bin\n# ./plugin install mobz/elasticsearch-head\n# http://es-client-01:9200/_plugin/head\n")),(0,r.kt)("h2",{id:"04_03-creating-the-first-master-node"},"04_03-Creating the First Master Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'cluster.name: globomantics_kb_production\n\nnode.name: es-master-01 #/etc/hostname\n\nnode.data: false\nnode.master: true\nnode.client: false\n\n#The node will bind to this hostname or IP address and publish (advertise) this host to other nodes in the cluster.\nnetwork.host: \n\ndiscovery.zen.ping.multicast.enabled: false\ndiscovery.zen.ping.unicast.hosts: ["es-client-01", "es-client-02", "es-master-01","es-master-02","es-master-03","es-data-01","es-data-02","es-data-03"]\n\n')),(0,r.kt)("h2",{id:"04_04-creating-the-first-data-node"},"04_04-Creating the First Data Node"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},'cluster.name: globomantics_kb_production\n\nnode.name: es-data-01 #/etc/hostname\n\nnode.data: true\nnode.master: false\nnode.client: false\n\n#The node will bind to this hostname or IP address and publish (advertise) this host to other nodes in the cluster.\nnetwork.host: \n\ndiscovery.zen.ping.multicast.enabled: false\ndiscovery.zen.ping.unicast.hosts: ["es-client-01", "es-client-02", "es-master-01","es-master-02","es-master-03","es-data-01","es-data-02","es-data-03"]\n\n')))}u.isMDXComponent=!0}}]);