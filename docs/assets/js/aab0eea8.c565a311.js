"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[58195],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>d});var r=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var u=r.createContext({}),s=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):a(a({},n),e)),t},p=function(e){var n=s(e.components);return r.createElement(u.Provider,{value:n},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},f=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,l=e.originalType,u=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),m=s(t),f=i,d=m["".concat(u,".").concat(f)]||m[f]||c[f]||l;return t?r.createElement(d,a(a({ref:n},p),{},{components:t})):r.createElement(d,a({ref:n},p))}));function d(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var l=t.length,a=new Array(l);a[0]=f;var o={};for(var u in n)hasOwnProperty.call(n,u)&&(o[u]=n[u]);o.originalType=e,o[m]="string"==typeof e?e:i,a[1]=o;for(var s=2;s<l;s++)a[s]=t[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,t)}f.displayName="MDXCreateElement"},23127:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>a,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var r=t(87462),i=(t(67294),t(3905));const l={},a="ReadMe",o={unversionedId:"Symfony/Bundles/HTMLPurifier/ReadMe",id:"Symfony/Bundles/HTMLPurifier/ReadMe",title:"ReadMe",description:"chamilo-lms",source:"@site/docs/Symfony/Bundles/HTMLPurifier/ReadMe.md",sourceDirName:"Symfony/Bundles/HTMLPurifier",slug:"/Symfony/Bundles/HTMLPurifier/",permalink:"/notebook/docs/Symfony/Bundles/HTMLPurifier/",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/Symfony/Bundles/HTMLPurifier/ReadMe.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"google/recaptcha",permalink:"/notebook/docs/Symfony/Bundles/Google-Recaptcha"},next:{title:"LiipFunctionalTestBundle",permalink:"/notebook/docs/Symfony/Bundles/LiipFunctionalTestBundle"}},u={},s=[{value:"chamilo-lms",id:"chamilo-lms",level:2},{value:"moodle",id:"moodle",level:2},{value:"en-marche.fr",id:"en-marchefr",level:2},{value:"symfony4-demo",id:"symfony4-demo",level:2}],p={toc:s};function m(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"readme"},"ReadMe"),(0,i.kt)("h2",{id:"chamilo-lms"},"chamilo-lms"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"composer.json",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'"ezyang/htmlpurifier": "~4.10",'))),(0,i.kt)("li",{parentName:"ul"},"main\\inc\\lib\\security.lib.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"$config = HTMLPurifier_Config::createDefault();"),(0,i.kt)("li",{parentName:"ul"},"$purifier","[$user_status]"," = new HTMLPurifier($config);"),(0,i.kt)("li",{parentName:"ul"},"$purifier","[$user_status]","->purify($var);"))),(0,i.kt)("li",{parentName:"ul"},"main\\inc\\lib\\formvalidator\\Rule\\allowed_tags.inc.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"function convert_kses_to_htmlpurifier($allowed_tags)"),(0,i.kt)("li",{parentName:"ul"},"$allowed_html_student = convert_kses_to_htmlpurifier(array_merge($allowed_tags_student));"))),(0,i.kt)("li",{parentName:"ul"},"main\\wiki\\wiki.inc.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"$purifier = new HTMLPurifier();\n$_clean","['content']"," = $purifier->purify($_clean","['content']",");"))),(0,i.kt)("li",{parentName:"ul"},"src\\CoreBundle\\Component\\HTMLPurifier\\Filter\\AllowIframes.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"class AllowIframes extends HTMLPurifier_Filter"))),(0,i.kt)("li",{parentName:"ul"},"src\\CoreBundle\\Composer\\ScriptHandler.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"main/inc/lib/htmlpurifier")))),(0,i.kt)("p",null,"main\\inc\\lib\\security.lib.php"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"    $config = HTMLPurifier_Config::createDefault();\n    $config->set('Cache.SerializerPath', $cache_dir);\n    $config->set('Core.Encoding', api_get_system_encoding());\n    $config->set('HTML.Doctype', 'XHTML 1.0 Transitional');\n    $config->set('HTML.MaxImgLength', '2560');\n    $config->set('HTML.TidyLevel', 'light');\n    $config->set('Core.ConvertDocumentToFragment', false);\n    $config->set('Core.RemoveProcessingInstructions', true);\n\n    if ('true' == api_get_setting('enable_iframe_inclusion')) {\n        $config->set('Filter.Custom', [new AllowIframes()]);\n    }\n    // Shows _target attribute in anchors\n    $config->set('Attr.AllowedFrameTargets', ['_blank', '_top', '_self', '_parent']);\n\n    if (STUDENT == $user_status) {\n        global $allowed_html_student;\n        $config->set('HTML.SafeEmbed', true);\n        $config->set('HTML.SafeObject', true);\n        $config->set('Filter.YouTube', true);\n        $config->set('HTML.FlashAllowFullScreen', true);\n        $config->set('HTML.Allowed', $allowed_html_student);\n    } elseif (COURSEMANAGER == $user_status) {\n        global $allowed_html_teacher;\n        $config->set('HTML.SafeEmbed', true);\n        $config->set('HTML.SafeObject', true);\n        $config->set('Filter.YouTube', true);\n        $config->set('HTML.FlashAllowFullScreen', true);\n        $config->set('HTML.Allowed', $allowed_html_teacher);\n    } else {\n        global $allowed_html_anonymous;\n        $config->set('HTML.Allowed', $allowed_html_anonymous);\n    }\n\n    // We need it for example for the flv player (ids of surrounding div-tags have to be preserved).\n    $config->set('Attr.EnableID', true);\n    $config->set('CSS.AllowImportant', true);\n    // We need for the flv player the css definition display: none;\n    $config->set('CSS.AllowTricky', true);\n    $config->set('CSS.Proprietary', true);\n\n    // Allow uri scheme.\n    $config->set('URI.AllowedSchemes', [\n        'http' => true,\n        'https' => true,\n        'mailto' => true,\n        'ftp' => true,\n        'nntp' => true,\n        'news' => true,\n        'data' => true,\n    ]);\n\n    // Allow <video> tag\n    //$config->set('HTML.Doctype', 'HTML 4.01 Transitional');\n    $config->set('HTML.SafeIframe', true);\n\n    // Set some HTML5 properties\n    $config->set('HTML.DefinitionID', 'html5-definitions'); // unqiue id\n    $config->set('HTML.DefinitionRev', 1);\n    if ($def = $config->maybeGetRawHTMLDefinition()) {\n        // https://html.spec.whatwg.org/dev/media.html#the-video-element\n        $def->addElement(\n            'video',\n            'Block',\n            'Optional: (source, Flow) | (Flow, source) | Flow',\n            'Common',\n            [\n                'src' => 'URI',\n                'type' => 'Text',\n                'width' => 'Length',\n                'height' => 'Length',\n                'poster' => 'URI',\n                'preload' => 'Enum#auto,metadata,none',\n                'controls' => 'Bool',\n            ]\n        );\n        // https://html.spec.whatwg.org/dev/media.html#the-audio-element\n        $def->addElement(\n            'audio',\n            'Block',\n            'Optional: (source, Flow) | (Flow, source) | Flow',\n            'Common',\n            [\n                'autoplay' => 'Bool',\n                'src' => 'URI',\n                'loop' => 'Bool',\n                'preload' => 'Enum#auto,metadata,none',\n                'controls' => 'Bool',\n                'muted' => 'Bool',\n            ]\n        );\n        $def->addElement(\n            'source',\n            'Block',\n            'Flow',\n            'Common',\n            ['src' => 'URI', 'type' => 'Text']\n        );\n    }\n\n    $purifier[$user_status] = new HTMLPurifier($config);\n}\n\n    if (is_array($var)) {\n        return $purifier[$user_status]->purifyArray($var);\n    } else {\n        return $purifier[$user_status]->purify($var);\n    }\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$allowed_html_teacher = convert_kses_to_htmlpurifier(array_merge($allowed_tags_teacher));\n")),(0,i.kt)("p",null,"public\\main\\inc\\lib\\formvalidator\\Rule\\allowed_tags.inc.php"),(0,i.kt)("h2",{id:"moodle"},"moodle"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"moodle\\lib\\weblib.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"htmlpurifier/HTMLPurifier.safe-includes.php"),(0,i.kt)("li",{parentName:"ul"},"htmlpurifier/locallib.php"),(0,i.kt)("li",{parentName:"ul"},"$purifier = new HTMLPurifier($config)"))),(0,i.kt)("li",{parentName:"ul"},"moodle\\lib\\htmlpurifier\\HTMLPurifier.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"class HTMLPurifier"))),(0,i.kt)("li",{parentName:"ul"},"moodle\\lib\\htmlpurifier\\HTMLPurifier.safe-includes.php",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"HTMLPurifier.php"),(0,i.kt)("li",{parentName:"ul"},"HTMLPurifier/Config.php"),(0,i.kt)("li",{parentName:"ul"},"HTMLPurifier/Context.php")))),(0,i.kt)("h2",{id:"en-marchefr"},"en-marche.fr"),(0,i.kt)("p",null,"from pc"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"composer.json",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'"exercise/htmlpurifier-bundle": "^1.0",'))),(0,i.kt)("li",{parentName:"ul"},"config\\services\\services.xml",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Exercise\\HTMLPurifierBundle\\Form\\HTMLPurifierTransformer")))),(0,i.kt)("p",null,"from mac"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ezyang/htmlpurifier: v4.10.0"),(0,i.kt)("li",{parentName:"ul"},"exercise/htmlpurifier-bundle: 1.0"),(0,i.kt)("li",{parentName:"ul"},"config/services.yaml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# Form\nApp\\Form\\PurifiedTextareaType:\n    arguments:\n        -\n            default: '@app.html_purifier.default'\n            enrich_content: '@app.html_purifier.enrich_content'\n            basic_content: '@app.html_purifier.basic_content'\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"config/packages/exercise_html_purifier.yaml")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"exercise_html_purifier:\n    default:\n        Core.Encoding: 'UTF-8'\n        Cache.SerializerPermissions: ~\n    enrich_content:\n        HTML.AllowedElements: p,h1,h2,h3,h4,h5,h6,div,address,center,em,strong,pre,div,u,s,ol,ul,li,br,img,a,iframe\n        HTML.AllowedAttributes: \"*.style,img.src,img.alt,a.href,a.target,*.class,iframe.src,iframe.width,iframe.height,iframe.frameborder\"\n        HTML.SafeIframe: true\n        URI.SafeIframeRegexp: '#^(https?:)?(\\/\\/www\\.youtube(?:-nocookie)?\\.com\\/embed\\/)#'\n        Attr.AllowedFrameTargets: \"_blank\"\n        CSS.AllowedProperties: text-align,border-style,border-width,float,height,width,margin\n        AutoFormat.Custom:\n            - '@App\\HTMLPurifier\\Injector\\ImageDimension'\n    basic_content:\n        HTML.AllowedElements: p,ol,ul,li,br\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"config/services/services.xml:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'\x3c!-- HTML Purifiers --\x3e\n<service id="app.html_purifier.default" class="Exercise\\HTMLPurifierBundle\\Form\\HTMLPurifierTransformer">\n    <argument type="service" id="exercise_html_purifier.default"/>\n</service>\n<service id="app.html_purifier.enrich_content" class="Exercise\\HTMLPurifierBundle\\Form\\HTMLPurifierTransformer">\n    <argument type="service" id="exercise_html_purifier.enrich_content"/>\n</service>\n<service id="app.html_purifier.basic_content" class="Exercise\\HTMLPurifierBundle\\Form\\HTMLPurifierTransformer">\n    <argument type="service" id="exercise_html_purifier.basic_content"/>\n</service>\n<service id="App\\HTMLPurifier\\Injector\\ImageDimension">\n    <argument>%image_max_length%</argument>\n</service>\n')),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"src/Admin/CitizenProjectAdmin.php")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"use App\\Form\\PurifiedTextareaType;\n\n    ->add('proposedSolution', PurifiedTextareaType::class, [\n        'label' => 'Solution du probl\xe8me',\n        'filter_emojis' => true,\n        'purifier_type' => 'enrich_content',\n        'attr' => ['class' => 'ck-editor'],\n    ])\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"src/Form/PurifiedTextareaType.php")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"    $resolver->setDefaults([\n        'purifier_type' => 'default',\n    ]);\n\n    $resolver->setAllowedValues('purifier_type', array_keys($this->purifierTransformers));\n")),(0,i.kt)("h2",{id:"symfony4-demo"},"symfony4-demo"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"composer.json"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},'"ezyang/htmlpurifier": "^4.9"'),(0,i.kt)("li",{parentName:"ul"},'"erusev/parsedown": "^1.6",'))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"App\\Utils\\Markdown"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"namespace App\\Utils;\n\nclass Markdown\n{\n    private $parser;\n    private $purifier;\n\n    public function __construct()\n    {\n        $this->parser = new \\Parsedown();\n\n        $purifierConfig = \\HTMLPurifier_Config::create([\n            'Cache.DefinitionImpl' => null, // Disable caching\n        ]);\n        $this->purifier = new \\HTMLPurifier($purifierConfig);\n    }\n\n    public function toHtml(string $text): string\n    {\n        $html = $this->parser->text($text);\n        $safeHtml = $this->purifier->purify($html);\n\n        return $safeHtml;\n    }\n}\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"App\\Twig\\AppExtension.php")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"    private $parser;\n\n    public function __construct(Markdown $parser, $locales)\n\n        new TwigFilter('md2html', [$this, 'markdownToHtml'], ['is_safe' => ['html']]),\n\n    /**\n     * Transforms the given Markdown content into HTML content.\n     */\n    public function markdownToHtml(string $content): string\n    {\n        return $this->parser->toHtml($content);\n    }\n\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"templates/admin/blog/show.html.twig")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-twig"},"    {{ post.content|md2html }}\n")))}m.isMDXComponent=!0}}]);