"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[73173],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>m});var n=r(67294);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t){if(null==e)return{};var r,n,s=function(e,t){if(null==e)return{};var r,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var l=n.createContext({}),p=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=p(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,u=a(e,["components","mdxType","originalType","parentName"]),c=p(r),d=s,m=c["".concat(l,".").concat(d)]||c[d]||h[d]||o;return r?n.createElement(m,i(i({ref:t},u),{},{components:r})):n.createElement(m,i({ref:t},u))}));function m(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=r.length,i=new Array(o);i[0]=d;var a={};for(var l in t)hasOwnProperty.call(t,l)&&(a[l]=t[l]);a.originalType=e,a[c]="string"==typeof e?e:s,i[1]=a;for(var p=2;p<o;p++)i[p]=r[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},52944:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>p});var n=r(87462),s=(r(67294),r(3905));const o={},i="NGINX 1.13.9 Introduces HTTP/2 Server Push",a={unversionedId:"Nginx/NGINX 1_13_9 Introduces HTTP2 Server Push",id:"Nginx/NGINX 1_13_9 Introduces HTTP2 Server Push",title:"NGINX 1.13.9 Introduces HTTP/2 Server Push",description:"https://www.nginx.com/blog/nginx-1-13-9-http2-server-push/",source:"@site/docs/Nginx/NGINX 1_13_9 Introduces HTTP2 Server Push.md",sourceDirName:"Nginx",slug:"/Nginx/NGINX 1_13_9 Introduces HTTP2 Server Push",permalink:"/notebook/docs/Nginx/NGINX 1_13_9 Introduces HTTP2 Server Push",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/Nginx/NGINX 1_13_9 Introduces HTTP2 Server Push.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Increase file upload size limit in PHP-Nginx",permalink:"/notebook/docs/Nginx/Increase file upload size limit in PHP-Nginx"},next:{title:"NGINX as a WebSocket Proxy",permalink:"/notebook/docs/Nginx/NGINX as a WebSocket Proxy"}},l={},p=[{value:"Verifying HTTP/2 Server Push",id:"verifying-http2-server-push",level:2}],u={toc:p};function c(e){let{components:t,...r}=e;return(0,s.kt)("wrapper",(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"nginx-1139-introduces-http2-server-push"},"NGINX 1.13.9 Introduces HTTP/2 Server Push"),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://www.nginx.com/blog/nginx-1-13-9-http2-server-push/"},"https://www.nginx.com/blog/nginx-1-13-9-http2-server-push/")),(0,s.kt)("p",null,"We\u2019re delighted to announce that NGINX 1.13.9, released on February 20, 2018, includes support for HTTP/2 server push."),(0,s.kt)("p",null,"Server push, which is defined in the HTTP/2 specification, allows a server to preemptively push resources to a remote client, anticipating that the client may soon request those resources. By doing so, you can potentially reduce the number of RTTs (round trip time \u2013 the time needed for a request and response) in a page\u2011load operation by one RTT or more, providing faster response to the user."),(0,s.kt)("p",null,"Server push can be used to prime a client with style sheets, images, and other resources that it will need to render a web page. You should take care to only push resources that are required; don\u2019t push resources that a client is likely to already have cached."),(0,s.kt)("p",null,"In this blog post, I describe:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"Basic configuration for HTTP/2 server push"),(0,s.kt)("li",{parentName:"ul"},"How to verify that HTTP/2 server push is working (using browser tools or nghttp)"),(0,s.kt)("li",{parentName:"ul"},"Automatically pushing content using the Link header"),(0,s.kt)("li",{parentName:"ul"},"Selectively pushing content"),(0,s.kt)("li",{parentName:"ul"},"Measuring the effect of HTTP/2 server push")),(0,s.kt)("p",null,"##Configuring HTTP/2 Server Push"),(0,s.kt)("p",null,"To push resources along with a page load, use the http2_push directive as follows:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"server {\n    # Ensure that HTTP/2 is enabled for the server\n    listen 443 ssl http2;\n\n    ssl_certificate ssl/certificate.pem;\n    ssl_certificate_key ssl/key.pem;\n\n    root /var/www/html;\n\n    # whenever a client requests demo.html, also push\n    # /style.css, /image1.jpg and /image2.jpg\n    location = /demo.html {\n        http2_push /style.css;\n        http2_push /image1.jpg;\n        http2_push /image2.jpg;\n    }\n}\n")),(0,s.kt)("h2",{id:"verifying-http2-server-push"},"Verifying HTTP/2 Server Push"),(0,s.kt)("p",null,"You can easily verify that server push is in effect using either of two methods:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"The developer tools in your web browser"),(0,s.kt)("li",{parentName:"ul"},"A command\u2011line HTTP/2 client such as nghttp")),(0,s.kt)("ol",null,(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Verifying with Developer Tools (Google Chrome)"),(0,s.kt)("ul",{parentName:"li"},(0,s.kt)("li",{parentName:"ul"},"Initiator "))),(0,s.kt)("li",{parentName:"ol"},(0,s.kt)("p",{parentName:"li"},"Verifying with a Command-Line Client (nghttp)"))),(0,s.kt)("p",null,"In addition to web browser tools, you can use the nghttp command\u2011line client from the nghttp2.org project to verify that server push is in effect."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"nghttp -ans https://example.com/demo.html\n")),(0,s.kt)("p",null,"##Automatically Pushing Resources to Clients"),(0,s.kt)("p",null,"NGINX also supports the convention of intercepting Link preload headers, then pushing the resources identified in these headers. To enable preload, include the http2_push_preload directive in the configuration:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"server {\n    # Ensure that HTTP/2 is enabled for the server\n    listen 443 ssl http2;\n\n    ssl_certificate ssl/certificate.pem;\n    ssl_certificate_key ssl/key.pem;\n\n    root /var/www/html;\n\n    # Intercept Link header and initiate requested Pushes\n    location = /myapp {\n        proxy_pass http://upstream;\n        http2_push_preload on;\n    }\n}\n")),(0,s.kt)("p",null,"For example, when NGINX is operating as a proxy (for HTTP, FastCGI, or other traffic types), the upstream server can add a Link header like this to its response:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"Link: </style.css>; as=style; rel=preload;\n")),(0,s.kt)("p",null,"NGINX intercepts this header and commences a server push of /style.css. The path in the Link header must be absolute"),(0,s.kt)("p",null,"To push multiple objects, you can provide multiple Link headers, or, better still, merge the list of objects into a comma-separated list:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"Link </style.css>; as=style; rel=preload, </favicon.ico>; as=image; rel=preload;\n")),(0,s.kt)("p",null,"If you don\u2019t want NGINX to push a preloaded resource, add a nopush parameter to the header:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},"# Resource is not pushed\nLink: </nginx.png>; as=image; rel=preload; nopush;\n")),(0,s.kt)("p",null,"When http2_push_preload is enabled, you can also initiate server push by setting the response header in your NGINX configuration:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'add_header Link "</style.css>; as=style; rel=preload;";\n')),(0,s.kt)("p",null,"##Selectively Pushing Resources to Clients"),(0,s.kt)("p",null,"One possible approach is to push resources to clients only on their first visit to the site. You can test for the presence of a session cookie, for example, and set the Link header conditionally, so the resources are preloaded only if the session cookie is not present."),(0,s.kt)("p",null,"Assuming clients are well\u2011behaved and include the cookie in subsequent requests, NGINX pushes the resources to the clients only once per browser session:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'server {\n    listen 443 ssl http2 default_server;\n\n    ssl_certificate ssl/certificate.pem;\n    ssl_certificate_key ssl/key.pem;\n\n    root /var/www/html;\n    http2_push_preload on;\n\n    location = /demo.html {\n        add_header Set-Cookie "session=1";\n        add_header Link $resources;\n    }\n}\n\nmap $http_cookie $resources {\n    "~*session=1" "";\n    default "</style.css>; as=style; rel=preload, </image1.jpg>; as=image; rel=preload, </image2.jpg>; as=style; rel=preload";\n}\n')))}c.isMDXComponent=!0}}]);