"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[31153],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>b});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=o.createContext({}),l=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=l(e.components);return o.createElement(p.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=l(n),d=i,b=c["".concat(p,".").concat(d)]||c[d]||h[d]||r;return n?o.createElement(b,a(a({ref:t},u),{},{components:n})):o.createElement(b,a({ref:t},u))}));function b(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=d;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s[c]="string"==typeof e?e:i,a[1]=s;for(var l=2;l<r;l++)a[l]=n[l];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},16335:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>a,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var o=n(87462),i=(n(67294),n(3905));const r={},a="Web Push library for PHP",s={unversionedId:"WebAPI/web-push/web-push-php",id:"WebAPI/web-push/web-push-php",title:"Web Push library for PHP",description:"https://github.com/web-push-libs/web-push-php",source:"@site/docs/WebAPI/web-push/web-push-php.md",sourceDirName:"WebAPI/web-push",slug:"/WebAPI/web-push/web-push-php",permalink:"/notebook/docs/WebAPI/web-push/web-push-php",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/WebAPI/web-push/web-push-php.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"setting-up-a-notifications-system-in-symfony-projects",permalink:"/notebook/docs/WebAPI/web-push/setting-up-a-notifications-system-in-symfony-project"},next:{title:"Real-Time Communication with WebRTC",permalink:"/notebook/docs/WebAPI/web-rtc/Real-Time Communication with WebRTC"}},p={},l=[{value:"Requirements",id:"requirements",level:2},{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Full examples of Web Push implementations",id:"full-examples-of-web-push-implementations",level:2},{value:"Authentication (VAPID)",id:"authentication-vapid",level:2}],u={toc:l};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"web-push-library-for-php"},"Web Push library for PHP"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/web-push-libs/web-push-php"},"https://github.com/web-push-libs/web-push-php")),(0,i.kt)("p",null,"WebPush can be used to send notifications to endpoints which server delivers Web Push notifications as described in the Web Push protocol. As it is standardized, you don't have to worry about what server type it relies on."),(0,i.kt)("h2",{id:"requirements"},"Requirements"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"PHP 7.1+",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"gmp"),(0,i.kt)("li",{parentName:"ul"},"mbstring"),(0,i.kt)("li",{parentName:"ul"},"curl"),(0,i.kt)("li",{parentName:"ul"},"openssl")))),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"composer require minishlink/web-push\n")),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nuse Minishlink\\WebPush\\WebPush;\nuse Minishlink\\WebPush\\Subscription;\n\n// array of notifications\n$notifications = [\n    [\n        'subscription' => Subscription::create([\n            'endpoint' => 'https://updates.push.services.mozilla.com/push/abc...', // Firefox 43+,\n            'publicKey' => 'BPcMbnWQL5GOYX/5LKZXT6sLmHiMsJSiEvIFvfcDvX7IZ9qqtq68onpTPEYmyxSQNiH7UD/98AUcQ12kBoxz/0s=', // base 64 encoded, should be 88 chars\n            'authToken' => 'CxVX6QsVToEGEcjfYPqXQw==', // base 64 encoded, should be 24 chars\n        ]),\n        'payload' => 'hello !',\n    ], [\n        'subscription' => Subscription::create([\n            'endpoint' => 'https://android.googleapis.com/gcm/send/abcdef...', // Chrome\n        ]),\n        'payload' => null,\n    ], [\n        'subscription' => Subscription::create([\n            'endpoint' => 'https://example.com/other/endpoint/of/another/vendor/abcdef...',\n            'publicKey' => '(stringOf88Chars)',\n            'authToken' => '(stringOf24Chars)',\n            'contentEncoding' => 'aesgcm', // one of PushManager.supportedContentEncodings\n        ]),\n        'payload' => '{msg:\"test\"}',\n    ], [\n          'subscription' => Subscription::create([ // this is the structure for the working draft from october 2018 (https://www.w3.org/TR/2018/WD-push-api-20181026/) \n              \"endpoint\" => \"https://example.com/other/endpoint/of/another/vendor/abcdef...\",\n              \"keys\" => [\n                  'p256dh' => '(stringOf88Chars)',\n                  'auth' => '(stringOf24Chars)'\n              ],\n          ]),\n          'payload' => '{msg:\"Hello World!\"}',\n      ],\n];\n\n$webPush = new WebPush();\n\n// send multiple notifications with payload\nforeach ($notifications as $notification) {\n    $webPush->sendNotification(\n        $notification['subscription'],\n        $notification['payload'] // optional (defaults null)\n    );\n}\n\n/**\n * Check sent results\n * @var MessageSentReport $report\n */\nforeach ($webPush->flush() as $report) {\n    $endpoint = $report->getRequest()->getUri()->__toString();\n\n    if ($report->isSuccess()) {\n        echo \"[v] Message sent successfully for subscription {$endpoint}.\";\n    } else {\n        echo \"[x] Message failed to sent for subscription {$endpoint}: {$report->getReason()}\";\n    }\n}\n\n/**\n * send one notification and flush directly\n * @var \\Generator<MessageSentReport> $sent\n */\n$sent = $webPush->sendNotification(\n    $notifications[0]['subscription'],\n    $notifications[0]['payload'], // optional (defaults null)\n    true // optional (defaults false)\n);\n\n")),(0,i.kt)("h2",{id:"full-examples-of-web-push-implementations"},"Full examples of Web Push implementations"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"An example with web-push-php: Minishlink/web-push-php-example"),(0,i.kt)("li",{parentName:"ul"},"Matthew Gaunt's Web Push Book - a must read"),(0,i.kt)("li",{parentName:"ul"},"Mozilla's ServiceWorker Cookbooks (don't mind the server.js file: it should be replaced by your PHP server code with this library)"),(0,i.kt)("li",{parentName:"ul"},"Google's introduction to push notifications (as of 03-20-2016, it doesn't mention notifications with payload)"),(0,i.kt)("li",{parentName:"ul"},"you may want to take a look at my own implementation: sw.js and app.js")),(0,i.kt)("h2",{id:"authentication-vapid"},"Authentication (VAPID)"),(0,i.kt)("p",null,"Browsers need to verify your identity. A standard called VAPID can authenticate you for all browsers. You'll need to create and provide a public and private key for your server. These keys must be safely stored and should not change."),(0,i.kt)("p",null,"You can specify your authentication details when instantiating WebPush. The keys can be passed directly (recommended), or you can load a PEM file or its content:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-php"},"<?php\n\nuse Minishlink\\WebPush\\WebPush;\n\n$endpoint = 'https://android.googleapis.com/gcm/send/abcdef...'; // Chrome\n\n$auth = [\n    'GCM' => 'MY_GCM_API_KEY', // deprecated and optional, it's here only for compatibility reasons\n    'VAPID' => [\n        'subject' => 'mailto:me@website.com', // can be a mailto: or your website address\n        'publicKey' => '~88 chars', // (recommended) uncompressed public key P-256 encoded in Base64-URL\n        'privateKey' => '~44 chars', // (recommended) in fact the secret multiplier of the private key encoded in Base64-URL\n        'pemFile' => 'path/to/pem', // if you have a PEM file and can link to it on your filesystem\n        'pem' => 'pemFileContent', // if you have a PEM file and want to hardcode its content\n    ],\n];\n\n$webPush = new WebPush($auth);\n$webPush->sendNotification(...);\n")),(0,i.kt)("p",null,"In order to generate the uncompressed public and secret key, encoded in Base64, enter the following in your Linux bash:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ openssl ecparam -genkey -name prime256v1 -out private_key.pem\n$ openssl ec -in private_key.pem -pubout -outform DER|tail -c 65|base64|tr -d '=' |tr '/+' '_-' >> public_key.txt\n$ openssl ec -in private_key.pem -outform DER|tail -c +8|head -c 32|base64|tr -d '=' |tr '/+' '_-' >> private_key.txt\n")))}c.isMDXComponent=!0}}]);