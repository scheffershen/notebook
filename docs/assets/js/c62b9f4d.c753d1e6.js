"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[32956],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),u=c(n),d=r,h=u["".concat(l,".").concat(d)]||u[d]||m[d]||s;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[u]="string"==typeof e?e:r,o[1]=i;for(var c=2;c<s;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},48152:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const s={},o="Testing",i={unversionedId:"Symfony/tests/testing",id:"Symfony/tests/testing",title:"Testing",description:"- en-marche.fr",source:"@site/docs/Symfony/tests/testing.md",sourceDirName:"Symfony/tests",slug:"/Symfony/tests/testing",permalink:"/notebook/docs/Symfony/tests/testing",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/Symfony/tests/testing.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"symfony datatables server side",permalink:"/notebook/docs/Symfony/dataTables/symfony datatables server side"},next:{title:"En Marche Testing",permalink:"/notebook/docs/Symfony/tests/testing_en-marche"}},l={},c=[{value:"ResidenceCMS vs SymForum vs europharma vs en-marche.fr vs Kimai2",id:"residencecms-vs-symforum-vs-europharma-vs-en-marchefr-vs-kimai2",level:2},{value:"WebTestCase API",id:"webtestcase-api",level:2},{value:"Unit Tests (use PHPUnitFrameworkTestCase)",id:"unit-tests-use-phpunitframeworktestcase",level:3},{value:"Integration Tests (use SymfonyBundleFrameworkBundleTestKernelTestCase;)",id:"integration-tests-use-symfonybundleframeworkbundletestkerneltestcase",level:3},{value:"Application Tests (use SymfonyBundleFrameworkBundleTestWebTestCase;)",id:"application-tests-use-symfonybundleframeworkbundletestwebtestcase",level:2},{value:"Browsing the Site",id:"browsing-the-site",level:3},{value:"Redirecting",id:"redirecting",level:3},{value:"Logging in Users (Authentication)",id:"logging-in-users-authentication",level:3},{value:"Making AJAX Requests",id:"making-ajax-requests",level:3},{value:"Sending Custom Headers (ex: ResidenceCMS)",id:"sending-custom-headers-ex-residencecms",level:3},{value:"Reporting Exceptions",id:"reporting-exceptions",level:3},{value:"Accessing Internal Objects",id:"accessing-internal-objects",level:3},{value:"Clicking on Links",id:"clicking-on-links",level:3},{value:"Submitting Forms",id:"submitting-forms",level:2},{value:"Configuring a Database for Tests",id:"configuring-a-database-for-tests",level:2},{value:"Resetting the Database Automatically Before each Test",id:"resetting-the-database-automatically-before-each-test",level:2},{value:".env.test",id:"envtest",level:2}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"testing"},"Testing"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/notebook/docs/Symfony/tests/testing_en-marche"},"en-marche.fr")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/notebook/docs/Symfony/tests/testing_kimai2"},"Kimai2")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/notebook/docs/Symfony/tests/testing_residenceCMS"},"ResidenceCMS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/notebook/docs/Symfony/tests/testing_symForum"},"SymForum")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/notebook/docs/Symfony/tests/testing_lms"},"lms")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/notebook/docs/Symfony/tests/testing_wallabag"},"Wallabag"))),(0,r.kt)("p",null,"use syForum tests Structure, et plus en-marche.fr et kimai2 codes"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"composer require --dev phpunit/phpunit symfony/test-pack\nphp ./vendor/bin/phpunit\n")),(0,r.kt)("h2",{id:"residencecms-vs-symforum-vs-europharma-vs-en-marchefr-vs-kimai2"},"ResidenceCMS vs SymForum vs europharma vs en-marche.fr vs Kimai2"),(0,r.kt)("p",null,"The wninner are Kimai2, en-marche.fr, symForum"),(0,r.kt)("h2",{id:"webtestcase-api"},(0,r.kt)("a",{parentName:"h2",href:"https://symfony.com/doc/current/testing.html"},"WebTestCase API")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"PHPUnit")," is configured by the ",(0,r.kt)("inlineCode",{parentName:"p"},"phpunit.xml.dist")," file in the root of your application"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Symfony Flex automatically creates ",(0,r.kt)("inlineCode",{parentName:"p"},"phpunit.xml.dist")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"tests/bootstrap.php"),". If these files are missing, you can try running the recipe again using ",(0,r.kt)("inlineCode",{parentName:"p"},"composer recipes:install phpunit/phpunit --force -v"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ php ./vendor/bin/phpunit tests/Form/UserTypeTest.php\n")),(0,r.kt)("h3",{id:"unit-tests-use-phpunitframeworktestcase"},"Unit Tests (use PHPUnit\\Framework\\TestCase)"),(0,r.kt)("h3",{id:"integration-tests-use-symfonybundleframeworkbundletestkerneltestcase"},"Integration Tests (use Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase;)"),(0,r.kt)("p",null,"An integration test will test a larger part of your application compared to a unit test (e.g. a combination of services). Integration tests might want to use the Symfony Kernel to fetch a service from the dependency injection containe"),(0,r.kt)("p",null,"Symfony provides a Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase class to help you creating and booting the kernel in your tests using bootKernel():"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Retrieving Services in the Test")),(0,r.kt)("p",null,"In your integration tests, you often need to fetch the service from the service container to call a specific method. After booting the kernel, the container is stored in self::$container:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// tests/Service/NewsletterGeneratorTest.php\nnamespace App\\Tests\\Service;\n\nuse App\\Service\\NewsletterGenerator;\nuse Symfony\\Bundle\\FrameworkBundle\\Test\\KernelTestCase;\n\nclass NewsletterGeneratorTest extends KernelTestCase\n{\n    public function testSomething()\n    {\n        // (1) boot the Symfony kernel\n        self::bootKernel();\n        // (2) use self::$container to access the service container\n        $container = self::$container;\n        // (3) run some service & test the result\n        $newsletterGenerator = $container->get(NewsletterGenerator::class);\n        $newsletter = $newsletterGenerator->generateMonthlyNews(...);\n        $this->assertEquals(..., $newsletter->getContent());\n    }\n}\n")),(0,r.kt)("h2",{id:"application-tests-use-symfonybundleframeworkbundletestwebtestcase"},"Application Tests (use Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase;)"),(0,r.kt)("p",null,"Application tests check the integration of all the different layers of the application (from the routing to the views)"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Make a request;"),(0,r.kt)("li",{parentName:"ol"},"Interact with the page (e.g. click on a link or submit a form);"),(0,r.kt)("li",{parentName:"ol"},"Test the response;"),(0,r.kt)("li",{parentName:"ol"},"Rinse and repeat.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The tools used in this section can be installed via the symfony/test-pack, use ",(0,r.kt)("inlineCode",{parentName:"p"},"composer require symfony/test-pack")," if you haven\u2019t done so already.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"php bin/console make:test\n    > WebTestCase\n")),(0,r.kt)("p",null,"example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// tests/Controller/PostControllerTest.php\nnamespace App\\Tests\\Controller;\n\nuse Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase;\n\nclass PostControllerTest extends WebTestCase\n{\n    public function testSomething(): void\n    {\n        // This calls KernelTestCase::bootKernel(), and creates a\n        // \"client\" that is acting as the browser\n        $client = static::createClient();\n\n        // Request a specific page\n        $crawler = $client->request('GET', '/');\n\n        // Validate a successful response and some content\n        $this->assertResponseIsSuccessful();\n        $this->assertSelectorTextContains('h1', 'Hello World');\n    }\n}\n")),(0,r.kt)("p",null,"The full signature of the request() method is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"request(\n    $method,\n    $uri,\n    array $parameters = [],\n    array $files = [],\n    array $server = [],\n    $content = null,\n    $changeHistory = true\n)\n")),(0,r.kt)("p",null,"This allows you to create all types of requests you can think of:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"[Browsing the Site][]"),(0,r.kt)("li",{parentName:"ul"},"[Redirecting][]")),(0,r.kt)("h3",{id:"browsing-the-site"},"Browsing the Site"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$client->back();\n$client->forward();\n$client->reload();\n\n// clears all cookies and the history\n$client->restart();\n")),(0,r.kt)("h3",{id:"redirecting"},"Redirecting"),(0,r.kt)("p",null,"When a request returns a redirect response, the client does not follow it automatically. You can examine the response and force a redirection afterwards with the ",(0,r.kt)("inlineCode",{parentName:"p"},"followRedirect()")," method:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$crawler = $client->followRedirect();\n")),(0,r.kt)("p",null,"If you want the client to automatically follow all redirects, you can force them by calling the ",(0,r.kt)("inlineCode",{parentName:"p"},"followRedirects()")," method before performing the request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$client->followRedirects();\n")),(0,r.kt)("p",null,"If you pass ",(0,r.kt)("inlineCode",{parentName:"p"},"false")," to the ",(0,r.kt)("inlineCode",{parentName:"p"},"followRedirects()")," method, the redirects will no longer be followed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$client->followRedirects(false);\n")),(0,r.kt)("h3",{id:"logging-in-users-authentication"},"Logging in Users (Authentication)"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"New in version 5.1:The loginUser() method was introduced in Symfony 5.1")),(0,r.kt)("p",null,"When you want to add application tests for protected pages, you have to first \u201clogin\u201d as a user. Reproducing the actual steps - such as submitting a login form - make a test very slow. For this reason, Symfony provides a ",(0,r.kt)("inlineCode",{parentName:"p"},"loginUser()")," method to simulate logging in in your functional tests."),(0,r.kt)("p",null,"Instead of logging in with real users, it\u2019s recommended to create a user only for tests. You can do that with Doctrine ",(0,r.kt)("inlineCode",{parentName:"p"},"data fixtures"),", to load the testing users only in the test database."),(0,r.kt)("p",null,"After loading users in your database, use your user repository to fetch this user and use ",(0,r.kt)("inlineCode",{parentName:"p"},"$client->loginUser()")," to simulate a login request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// tests/Controller/ProfileControllerTest.php\nnamespace App\\Tests\\Controller;\n\nuse App\\Repository\\UserRepository;\nuse Symfony\\Bundle\\FrameworkBundle\\Test\\WebTestCase;\n\nclass ProfileControllerTest extends WebTestCase\n{\n    // ...\n\n    public function testVisitingWhileLoggedIn()\n    {\n        $client = static::createClient();\n        $userRepository = static::$container->get(UserRepository::class);\n\n        // retrieve the test user\n        $testUser = $userRepository->findOneByEmail('john.doe@example.com');\n\n        // simulate $testUser being logged in\n        $client->loginUser($testUser);\n\n        // test e.g. the profile page\n        $client->request('GET', '/profile');\n        $this->assertResponseIsSuccessful();\n        $this->assertSelectorTextContains('h1', 'Hello John!');\n    }\n}\n")),(0,r.kt)("p",null,"You can pass any ",(0,r.kt)("inlineCode",{parentName:"p"},"Symfony\\Component\\Security\\Core\\User\\UserInterface")," instance to ",(0,r.kt)("inlineCode",{parentName:"p"},"loginUser()"),". This method creates a special ",(0,r.kt)("inlineCode",{parentName:"p"},"Symfony\\Bundle\\FrameworkBundle\\Test\\TestBrowserToken")," object and stores in the session of the test client."),(0,r.kt)("h3",{id:"making-ajax-requests"},"Making AJAX Requests"),(0,r.kt)("p",null,"The client provides a ",(0,r.kt)("inlineCode",{parentName:"p"},"xmlHttpRequest()")," method, which has the same arguments as the ",(0,r.kt)("inlineCode",{parentName:"p"},"request()")," method and is a shortcut to make AJAX requests:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// the required HTTP_X_REQUESTED_WITH header is added automatically\n$client->xmlHttpRequest('POST', '/submit', ['name' => 'Fabien']);\n")),(0,r.kt)("h3",{id:"sending-custom-headers-ex-residencecms"},"Sending Custom Headers (ex: ResidenceCMS)"),(0,r.kt)("p",null,"If your application behaves according to some HTTP headers, pass them as the second argument of ",(0,r.kt)("inlineCode",{parentName:"p"},"createClient()"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$client = static::createClient([], [\n    'HTTP_HOST'       => 'en.example.com',\n    'HTTP_USER_AGENT' => 'MySuperBrowser/1.0',\n]);\n")),(0,r.kt)("p",null,"You can also override HTTP headers on a per request basis:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"$client->request('GET', '/', [], [], [\n    'HTTP_HOST'       => 'en.example.com',\n    'HTTP_USER_AGENT' => 'MySuperBrowser/1.0',\n]);\n")),(0,r.kt)("h3",{id:"reporting-exceptions"},"Reporting Exceptions"),(0,r.kt)("p",null,"Debugging exceptions in application tests may be difficult because by default they are caught and you need to look at the logs to see which exception was thrown. Disabling catching of exceptions in the test client allows the exception to be reported by PHPUnit:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$client->catchExceptions(false);\n")),(0,r.kt)("h3",{id:"accessing-internal-objects"},"Accessing Internal Objects"),(0,r.kt)("p",null,"If you use the client to test your application, you might want to access the client\u2019s internal objects:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$history = $client->getHistory();\n$cookieJar = $client->getCookieJar();\n")),(0,r.kt)("p",null,"You can also get the objects related to the latest request:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"    // the HttpKernel request instance\n    $request = $client->getRequest();\n    // the BrowserKit request instance\n    $request = $client->getInternalRequest();\n    // the HttpKernel response instance\n    $response = $client->getResponse();\n    // the BrowserKit response instance\n    $response = $client->getInternalResponse();\n    // the Crawler instance\n    $crawler = $client->getCrawler();\n")),(0,r.kt)("h3",{id:"clicking-on-links"},"Clicking on Links"),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"clickLink()")," method to click on the first link that contains the given text (or the first clickable image with that alt attribute):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// option 1\n$client = static::createClient();\n$client->request('GET', '/post/hello-world');\n$client->clickLink('Click here');\n")),(0,r.kt)("p",null,"If you need access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Symfony\\Component\\DomCrawler\\Link")," object that provides helpful methods specific to links (such as ",(0,r.kt)("inlineCode",{parentName:"p"},"getMethod()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"getUri()"),"), use the ",(0,r.kt)("inlineCode",{parentName:"p"},"Crawler::selectLink()")," method instead:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// option 2\n$client = static::createClient();\n$crawler = $client->request('GET', '/post/hello-world');\n$link = $crawler->selectLink('Click here')->link();\n// use click() if you want to click the selected link\n$client->click($link);\n")),(0,r.kt)("h2",{id:"submitting-forms"},"Submitting Forms"),(0,r.kt)("p",null,"Use the ",(0,r.kt)("inlineCode",{parentName:"p"},"submitForm()")," method to submit the form that contains the given button:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// option 1\n$client = static::createClient();\n$client->request('GET', '/post/hello-world');\n$crawler = $client->submitForm('Add comment', [\n    'comment_form[content]' => '...',\n]);\n")),(0,r.kt)("p",null,"The first argument of ",(0,r.kt)("inlineCode",{parentName:"p"},"submitForm()")," is the text content, ",(0,r.kt)("inlineCode",{parentName:"p"},"id"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," of any ",(0,r.kt)("inlineCode",{parentName:"p"},"<button>")," or ",(0,r.kt)("inlineCode",{parentName:"p"},'<input type="submit">')," included in the form. The second optional argument is used to override the default form field values."),(0,r.kt)("p",null,"If you need access to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Symfony\\Component\\DomCrawler\\Form")," object that provides helpful methods specific to forms (such as ",(0,r.kt)("inlineCode",{parentName:"p"},"getUri()"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"getValues()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"getFields()"),") use the ",(0,r.kt)("inlineCode",{parentName:"p"},"Crawler::selectButton()")," method instead:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"// option 2\n$client = static::createClient();\n$crawler = $client->request('GET', '/post/hello-world');\n// select the button\n$buttonCrawlerNode = $crawler->selectButton('submit');\n// retrieve the Form object for the form belonging to this button\n$form = $buttonCrawlerNode->form();\n// set values on a form object\n$form['my_form[name]'] = 'Fabien';\n$form['my_form[subject]'] = 'Symfony rocks!';\n// submit the Form object\n$client->submit($form);\n// optionally, you can combine the last 2 steps by passing an array of\n// field values while submitting the form:\n$client->submit($form, [\n    'my_form[name]'    => 'Fabien',\n    'my_form[subject]' => 'Symfony rocks!',\n])\n")),(0,r.kt)("p",null,"Based on the form type, you can use different methods to fill in the input:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-php"},"\n// selects an option or a radio\n$form['my_form[country]']->select('France');\n// ticks a checkbox\n$form['my_form[like_symfony]']->tick();\n// uploads a file\n$form['my_form[photo]']->upload('/path/to/lucas.jpg');\n// In the case of a multiple file upload\n$form['my_form[field][0]']->upload('/path/to/lucas.jpg');\n$form['my_form[field][1]']->upload('/path/to/lisa.jpg');\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"submit()")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"submitForm()")," methods define optional arguments to add custom server parameters and HTTP headers when submitting the form:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$client->submit($form, [], ['HTTP_ACCEPT_LANGUAGE' => 'es']);\n$client->submitForm($button, [], 'POST', ['HTTP_ACCEPT_LANGUAGE' => 'es']);\n")),(0,r.kt)("h2",{id:"configuring-a-database-for-tests"},"Configuring a Database for Tests"),(0,r.kt)("p",null,"Tests that interact with the database should use their own separate database to not mess with the databases used."),(0,r.kt)("p",null,"To do that, edit or create the ",(0,r.kt)("inlineCode",{parentName:"p"},".env.test.local")," file at the root directory of your project and define the new value for the ",(0,r.kt)("inlineCode",{parentName:"p"},"DATABASE_URL")," env var:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'# .env.test.local\nDATABASE_URL="mysql://USERNAME:PASSWORD@127.0.0.1:3306/DB_NAME_test?serverVersion=5.7"\n')),(0,r.kt)("p",null,"After that, you can create the test database and all tables using:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"php bin/console --env=test doctrine:database:create\nphp bin/console --env=test doctrine:schema:create\n")),(0,r.kt)("h2",{id:"resetting-the-database-automatically-before-each-test"},"Resetting the Database Automatically Before each Test"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"DAMADoctrineTestBundle")," uses Doctrine transactions to let each test interact with an unmodified database. Install it using:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"composer require --dev dama/doctrine-test-bundle\n")),(0,r.kt)("p",null,"That\u2019s it! This bundle uses a clever trick: it begins a database transaction before every test and rolls it back automatically after the test finishes to undo all changes. Read more in the documentation of the ",(0,r.kt)("inlineCode",{parentName:"p"},"DAMADoctrineTestBundle"),"."),(0,r.kt)("h2",{id:"envtest"},".env.test"),(0,r.kt)("p",null,"ResidenceCMS"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# define your env variables for the test env here\nKERNEL_CLASS='App\\Kernel'\nAPP_SECRET='$ecretf0rt3st'\nSYMFONY_DEPRECATIONS_HELPER=999999\nPANTHER_APP_ENV=panther\n\nDATABASE_URL=mysql://db_user:db_password@127.0.0.1:3306/db_name\n")),(0,r.kt)("p",null,"SymForum"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# define your env variables for the test env here\nKERNEL_CLASS='App\\Kernel'\nAPP_SECRET='$ecretf0rt3st'\nSYMFONY_DEPRECATIONS_HELPER=999999\nPANTHER_APP_ENV=panther\nPANTHER_ERROR_SCREENSHOT_DIR=./var/error-screenshots\n\nDATABASE_URL=\"sqlite:///%kernel.project_dir%/var/test.db\"\n")))}u.isMDXComponent=!0}}]);