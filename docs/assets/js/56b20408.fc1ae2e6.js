"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[31352],{3905:(t,e,n)=>{n.d(e,{Zo:()=>c,kt:()=>u});var i=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,i,r=function(t,e){if(null==t)return{};var n,i,r={},l=Object.keys(t);for(i=0;i<l.length;i++)n=l[i],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(i=0;i<l.length;i++)n=l[i],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var p=i.createContext({}),s=function(t){var e=i.useContext(p),n=e;return t&&(n="function"==typeof t?t(e):a(a({},e),t)),n},c=function(t){var e=s(t.components);return i.createElement(p.Provider,{value:e},t.children)},h="mdxType",m={inlineCode:"code",wrapper:function(t){var e=t.children;return i.createElement(i.Fragment,{},e)}},d=i.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,p=t.parentName,c=o(t,["components","mdxType","originalType","parentName"]),h=s(n),d=r,u=h["".concat(p,".").concat(d)]||h[d]||m[d]||l;return n?i.createElement(u,a(a({ref:e},c),{},{components:n})):i.createElement(u,a({ref:e},c))}));function u(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,a=new Array(l);a[0]=d;var o={};for(var p in e)hasOwnProperty.call(e,p)&&(o[p]=e[p]);o.originalType=t,o[h]="string"==typeof t?t:r,a[1]=o;for(var s=2;s<l;s++)a[s]=n[s];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3660:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>p,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var i=n(87462),r=(n(67294),n(3905));const l={},a="Medflixs 2017",o={unversionedId:"Nginx/medflix_2017_nginx",id:"Nginx/medflix_2017_nginx",title:"Medflixs 2017",description:"history nfs  mount stockage.medflixs.com",source:"@site/docs/Nginx/medflix_2017_nginx.md",sourceDirName:"Nginx",slug:"/Nginx/medflix_2017_nginx",permalink:"/notebook/docs/Nginx/medflix_2017_nginx",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/Nginx/medflix_2017_nginx.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Installing nginx",permalink:"/notebook/docs/Nginx/installingNgnix"},next:{title:"nginx-multiple-php-sites-on-different-ports-on-1-server",permalink:"/notebook/docs/Nginx/nginx-multiple-php-sites-on-different-ports"}},p={},s=[{value:"history nfs  mount stockage.medflixs.com",id:"history-nfs--mount-stockagemedflixscom",level:2},{value:"var/log/elasticsearch log 4.2Go espace",id:"varlogelasticsearch-log-42go-espace",level:2},{value:"attention /var/archives va planter la machine !!!",id:"attention-vararchives-va-planter-la-machine-",level:2},{value:"SVN revert",id:"svn-revert",level:2},{value:"nginx",id:"nginx",level:2},{value:"SVN",id:"svn",level:2},{value:"local",id:"local",level:2},{value:"how-to-set-fielddata-true-in-kibana",id:"how-to-set-fielddata-true-in-kibana",level:2},{value:"root@ns223724:/home/adminum# sudo certbot --nginx -d www.medflixs.com",id:"rootns223724homeadminum-sudo-certbot---nginx--d-wwwmedflixscom",level:2},{value:"Elasticsearch",id:"elasticsearch",level:2},{value:"phpmyadmin",id:"phpmyadmin",level:2},{value:"nginx 1.10.3",id:"nginx-1103",level:2},{value:"\u5728 Nginx 1.15.8\u4e2d\uff0c\u5b89\u88dd more_set_headers",id:"\u5728-nginx-1158\u4e2d\u5b89\u88dd-more_set_headers",level:2},{value:"nginx1.19.2",id:"nginx1192",level:2},{value:"nginx1.18.0",id:"nginx1180",level:2},{value:"nginx 1.7.3",id:"nginx-173",level:2}],c={toc:s};function h(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,i.Z)({},c,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"medflixs-2017"},"Medflixs 2017"),(0,r.kt)("h2",{id:"history-nfs--mount-stockagemedflixscom"},"history nfs  mount stockage.medflixs.com"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ dpkg -l nfs-kernel-server\n$ ll /nfs/hom/adminum/\n$ dpkg -l nfs-common\n$ showmount -e 54.38.82.77\n$ vi /etc/fstab\n$ mount 54.38.82.77:/home/adminum/ /nfs/home/adminum\n\nmysqldump -u root -p  medflixs2019 >  medflixs2019.sql\n\nscp -r -p adminum@46.105.114.35:/home/adminum/medflixs2020.sql medflixs2020.sql \n\nselect u.firstname, u.lastname, u.email, s.title from fos_user as u join specialite as s ON s.id = u.user_specialite_id \n")),(0,r.kt)("h2",{id:"varlogelasticsearch-log-42go-espace"},"var/log/elasticsearch log 4.2Go espace"),(0,r.kt)("h2",{id:"attention-vararchives-va-planter-la-machine-"},"attention /var/archives va planter la machine !!!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"now move to /home/archives\n\nservice apache2 stop\nservice php7.1-fpm start\nservice nginx start\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Install Nginx")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo apt-get install nginx apache2-utils\nsudo htpasswd -c /etc/nginx/htpasswd.users kibanaadmin\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"elastic Search")),(0,r.kt)("p",null,"mysqldump -u root -pMCj9!h6h medflixs2015 > medflixs2015.sql"),(0,r.kt)("p",null,"mysql -u root -psecret santesur < santesur.sql"),(0,r.kt)("h2",{id:"svn-revert"},"SVN revert"),(0,r.kt)("p",null,"login: yishen"),(0,r.kt)("p",null,"svn update  src/Formation/ -r235\nsvn update  src/Adminsitration/ -r235\nsvn update  src/Formation/ -r235"),(0,r.kt)("p",null,"scp Login1@Serveur1:Chemin1/NomFichier1 Login2@Serveur2:Chemin2/NomFichier2"),(0,r.kt)("p",null,"So for example to go from ",(0,r.kt)("em",{parentName:"p"},"revision 150")," (",(0,r.kt)("em",{parentName:"p"},"current"),") back to ",(0,r.kt)("em",{parentName:"p"},"revision 140"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'$ svn update\n$ svn merge -r 150:140 .\n$ svn commit -m "Rolled back to r140"\n')),(0,r.kt)("h2",{id:"nginx"},"nginx"),(0,r.kt)("p",null,"find big volume directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"du -a /var/www/2019.medflixs.com/ | sort -n -r | head -n 20\n")),(0,r.kt)("p",null,"find big volume directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sudo du -a / 2>/dev/null | sort -n -r | head -n 20\n\n/opt/letsencrypt/letsencrypt-auto renew\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/"},"https://www.nginx.com/blog/using-free-ssltls-certificates-from-lets-encrypt-with-nginx/")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'ps -ylC php-fpm --sort:rss\nps --no-headers -o "rss,cmd" -C php-fpm | awk \'{ sum+=$1 } END { printf ("\n')),(0,r.kt)("p",null,'%d%s\\n", sum/NR/1024,"M") }\''),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," tar -zxvf nginx-1.9.9.tar.gz\n cd nginx-1.9.9\n sudo apt-get install -y libpcre3 libpcre3-dev libpcrecpp0 libssl-dev zlib1\ng-dev\n sudo apt-get install -y libxslt-dev libxml2-dev\n sudo apt-get install -y libgd-dev\n apt-get autoremove\n apt-get install -y libgeoip-dev\n ./configure \n --with-cc-opt='-g -O2 -fstack-protector --param=ssp-buffer-size=4 -Wformat -Werror=format-security -D_FORTIFY_SOURCE=2' \n --with-ld-opt='-Wl,-Bsymbolic-functions -Wl,-z,relro' \n --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf \n --http-log-path=/var/log/nginx/access.log \n --error-log-path=/var/log/nginx/error.log \n--lock-path=/var/lock/nginx.lock \n--pid-path=/run/nginx.pid \n--http-client-body-temp-path=/var/lib/nginx/body \n--http-fastcgi-temp-path=/var/lib/nginx/fastcgi \n--http-proxy-temp-path=/var/lib/nginx/proxy \n--http-scgi-temp-path=/var/lib/nginx/scgi \n--http-uwsgi-temp-path=/var/lib/nginx/uwsgi \n--with-debug \n--with-pcre-jit \n--with-ipv6 \n--with-http_ssl_module \n--with-http_stub_status_module \n--with-http_realip_module \n--with-http_addition_module \n--with-http_dav_module \n--with-http_geoip_module \n--with-http_gzip_static_module \n--with-http_image_filter_module \n--with-http_sub_module \n--with-http_xslt_module \n--with-mail \n--with-mail_ssl_module \n--with-http_mp4_module \n--with-http_v2_module\n\nnginx -t\nnginx -V\n\n/etc/nginx/site-available/default\n")),(0,r.kt)("h2",{id:"svn"},"SVN"),(0,r.kt)("p",null,"add file not versionner"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'svn status | grep -v "^.[ \\t]*\\..*" | grep "^?" | awk \'{print $2}\' | xargs svn add\n')),(0,r.kt)("h2",{id:"local"},"local"),(0,r.kt)("p",null,"http://localhost:5601/app/sense"),(0,r.kt)("h2",{id:"how-to-set-fielddata-true-in-kibana"},"how-to-set-fielddata-true-in-kibana"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'curl -XPUT http://localhost:9200/index -d \'{\n  "mappings": {\n    "video": {\n      "properties": {\n        "date": {\n          "type": "text",\n          "fielddata": true\n        }\n      }\n    }\n  }\n}\'\n')),(0,r.kt)("h2",{id:"rootns223724homeadminum-sudo-certbot---nginx--d-wwwmedflixscom"},"root@ns223724:/home/adminum# sudo certbot --nginx -d ",(0,r.kt)("a",{parentName:"h2",href:"http://www.medflixs.com"},"www.medflixs.com")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"ssl_certificate /etc/letsencrypt/live/www.medflixs.com/fullchain.pem; # managed by Certbot\nssl_certificate_key /etc/letsencrypt/live/www.medflixs.com/privkey.pem; # managed by Certbot\n")),(0,r.kt)("p",null,"Saving debug log to ",(0,r.kt)("inlineCode",{parentName:"p"},"/var/log/letsencrypt/letsencrypt.log"),"\n",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/letsencrypt/options-ssl-nginx.conf")," has been manually modified;\nupdated file saved to ",(0,r.kt)("inlineCode",{parentName:"p"},"/usr/lib/python3/dist-packages/certbot_nginx/options-ss                        l-nginx.conf"),". We recommend updating ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/letsencrypt/options-ssl-nginx.conf")," for security purposes.\nPlugins selected: Authenticator nginx, Installer nginx\nStarting new HTTPS connection (1): acme-v02.api.letsencrypt.org\nAttempting to parse the version 1.9.0 renewal configuration file found at ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/letsencrypt/renewal/www.medflixs.com-0001.conf")," with version 0.31.0 of Certbot. This might not work.\nAttempting to parse the version 1.9.0 renewal configuration file found at /etc/letsencrypt/renewal/",(0,r.kt)("a",{parentName:"p",href:"http://www.medflixs.com.conf"},"www.medflixs.com.conf")," with version 0.31.0 of Certbot. This might not work.\nCert is due for renewal, auto-renewing..."),(0,r.kt)("p",null,"Renewing an existing certificate"),(0,r.kt)("p",null,"An unexpected error occurred:"),(0,r.kt)("p",null,"There were too many requests of a given type :: Error creating new order :: too many certificates (5) already issued for this exact set of domains in the last 168 hours: ",(0,r.kt)("a",{parentName:"p",href:"http://www.medflixs.com"},"www.medflixs.com"),": see ",(0,r.kt)("a",{parentName:"p",href:"https://letsencrypt.org/docs/rate-limits/"},"https://letsencrypt.org/docs/rate-limits/")),(0,r.kt)("p",null,"Please see the logfiles in /var/log/letsencrypt for more details."),(0,r.kt)("h2",{id:"elasticsearch"},"Elasticsearch"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'sudo /etc/init.d/elasticsearch start\n\ncurl localhost:9200\n\nfind / -name "elasticsearch"\n\nsudo service elasticsearch restart\n')),(0,r.kt)("h2",{id:"phpmyadmin"},"phpmyadmin"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"http://phpmyadmin.medflixs.com/"},"http://phpmyadmin.medflixs.com/"),"    "),(0,r.kt)("h2",{id:"nginx-1103"},"nginx 1.10.3"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://zhizhebuyan.com/2017/03/30/nginx%201.8.1%20%E5%8D%87%E7%BA%A7%E8%87%B3%201.10.3,%E5%B9%B6%E5%90%AF%E7%94%A8http2/"},"https://zhizhebuyan.com/2017/03/30/nginx%201.8.1%20\u5347\u7ea7\u81f3%201.10.3,\u5e76\u542f\u7528http2/")),(0,r.kt)("p",null," ","[root@www objs]","# ./nginx -V\nnginx version: nginx/1.10.3\nbuilt by gcc 4.4.7 20120313 (Red Hat 4.4.7-16) (GCC)\nbuilt with OpenSSL 1.0.1e-fips 11 Feb 2013\nTLS SNI support enabled\nconfigure arguments:\n--prefix=/etc/nginx\n--sbin-path=/usr/sbin/nginx\n--conf-path=/etc/nginx/nginx.conf\n--error-log-path=/var/log/nginx/error.log\n--http-log-path=/var/log/nginx/access.log\n--pid-path=/var/run/nginx.pid\n--lock-path=/var/run/nginx.lock\n--http-client-body-temp-path=/var/cache/nginx/client_temp\n--http-proxy-temp-path=/var/cache/nginx/proxy_temp\n--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp\n--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp\n--http-scgi-temp-path=/var/cache/nginx/scgi_temp\n--user=nginx\n--group=nginx\n--with-http_ssl_module\n--with-http_realip_module\n--with-http_addition_module\n--with-http_sub_module\n--with-http_dav_module\n--with-http_flv_module\n--with-http_mp4_module\n--with-http_gunzip_module\n--with-http_gzip_static_module\n--with-http_random_index_module\n--with-http_secure_link_module\n--with-http_stub_status_module\n--with-http_auth_request_module\n--with-mail\n--with-mail_ssl_module\n--with-file-aio\n--with-ipv6\n--add-module=/git/ngx_http_substitutions_filter_module\n--with-http_v2_module"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"mv /etc/sbin/nginx /etc/sbin/nginx.old\n\ncp nginx-1.10.3/objs/nginx /etc/sbin/nginx\n\nservice nginx restart\n")),(0,r.kt)("h2",{id:"\u5728-nginx-1158\u4e2d\u5b89\u88dd-more_set_headers"},"\u5728 Nginx 1.15.8\u4e2d\uff0c\u5b89\u88dd more_set_headers"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://hant.kaifa99.com/hulianwang/article_176824"},"https://hant.kaifa99.com/hulianwang/article_176824")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.cxyzjd.com/article/qq_45645003/104712260"},"https://www.cxyzjd.com/article/qq_45645003/104712260")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"tar zxf nginx-1.14.0.tar\n\ncd nginx-1.14.0\n\n./configure \n--prefix=/opt/nginx \n--user=nginx \n--group=nginx \n--with-threads \n--with-file-aio \n--with-http_ssl_module \n--with-http_realip_module \n--with-http_addition_module \n--with-http_xslt_module \n--with-http_image_filter_module \n--with-http_sub_module \n--with-http_flv_module \n--with-http_mp4_module \n--with-http_gunzip_module \n--with-http_gzip_static_module \n--with-http_auth_request_module \n--with-http_secure_link_module \n--with-pcre\n")),(0,r.kt)("h2",{id:"nginx1192"},"nginx1.19.2"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/weixin_36522099/article/details/108214741"},"https://blog.csdn.net/weixin_36522099/article/details/108214741")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ tar xzf nginx-1.19.2.tar.gz\n$ cd nginx-1.19.2\n$ ./configure \n--prefix=/usr/local/nginx \n--with-http_dav_module \n--with-http_stub_status_module \n--with-http_addition_module \n--with-http_sub_module \n--with-http_flv_module \n--with-http_mp4_module \n--with-pcre=/usr/local/src/pcre-8.41 \n--user=nginx \n--group=nginx\n")),(0,r.kt)("h2",{id:"nginx1180"},"nginx1.18.0"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://me.jinchuang.org/archives/941.html"},"https://me.jinchuang.org/archives/941.html")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"tar xf nginx-1.18.0.tar.gz\n\ncd nginx-1.18.0/\n    ./configure \\\n    --prefix=/usr/local/nginx \\\n    --pid-path=/var/run/nginx.pid \\\n    --lock-path=/var/run/nginx.lock \\\n    --http-client-body-temp-path=/usr/local/nginx/client_temp \\\n    --http-proxy-temp-path=/usr/local/nginx/proxy_temp \\\n    --http-fastcgi-temp-path=/usr/local/nginx/fastcgi_temp \\\n    --http-uwsgi-temp-path=/usr/local/nginx/uwsgi_temp \\\n    --http-scgi-temp-path=/usr/local/nginx/scgi_temp \\\n    --user=nginx \\\n    --group=nginx \\\n    --with-mail \\\n    --with-stream \\\n    --with-threads \\\n    --with-file-aio \\\n    --with-poll_module \\\n    --with-select_module \\\n    --with-http_v2_module \\\n    --with-http_mp4_module \\\n    --with-http_sub_module \\\n    --with-http_dav_module \\\n    --with-http_flv_module \\\n    --with-http_ssl_module \\\n    --with-http_geoip_module \\\n    --with-http_slice_module \\\n    --with-http_gunzip_module \\\n    --with-http_realip_module \\\n    --with-http_addition_module \\\n    --with-http_image_filter_module \\\n    --with-http_gzip_static_module \\\n    --with-http_random_index_module \\\n    --with-http_secure_link_module \\\n    --with-http_degradation_module \\\n    --with-http_stub_status_module \\\n    --with-mail_ssl_module \\\n    --with-stream_ssl_module \\\n    --with-stream_realip_module \\\n    --with-stream_ssl_preread_module \\\n    --with-pcre=/data/source/pcre-8.44 \\\n    --with-openssl=/data/source/openssl-1.1.1f \\\n    --with-zlib=/data/source/zlib-1.2.11\n\nmake && make install\necho 'export PATH=$PATH:/usr/local/nginx/sbin' >> /etc/profile && source /etc/profile\nnginx -V\nnginx\nnetstat -lntp\n")),(0,r.kt)("h2",{id:"nginx-173"},"nginx 1.7.3"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://blog.csdn.net/xiguashixiaoyu/article/details/111950377"},"https://blog.csdn.net/xiguashixiaoyu/article/details/111950377")))}h.isMDXComponent=!0}}]);