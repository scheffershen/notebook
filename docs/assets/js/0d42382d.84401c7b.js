"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2595],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>y});var r=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var i=r.createContext({}),u=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(i.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,l=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=u(n),d=l,y=m["".concat(i,".").concat(d)]||m[d]||p[d]||o;return n?r.createElement(y,a(a({ref:t},c),{},{components:n})):r.createElement(y,a({ref:t},c))}));function y(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=n.length,a=new Array(o);a[0]=d;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s[m]="string"==typeof e?e:l,a[1]=s;for(var u=2;u<o;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3783:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var r=n(7462),l=(n(7294),n(3905));const o={slug:"How-To-Create-a-Multi-Node-MySQL-Cluster-on-Ubuntu16"},a="How To Create a Multi-Node MySQL Cluster on Ubuntu 16.04",s={unversionedId:"MySQL/Cluster/How To Create a Multi-Node MySQL Cluster on Ubuntu16",id:"MySQL/Cluster/How To Create a Multi-Node MySQL Cluster on Ubuntu16",title:"How To Create a Multi-Node MySQL Cluster on Ubuntu 16.04",description:"link",source:"@site/docs/MySQL/Cluster/How To Create a Multi-Node MySQL Cluster on Ubuntu16.md",sourceDirName:"MySQL/Cluster",slug:"/MySQL/Cluster/How-To-Create-a-Multi-Node-MySQL-Cluster-on-Ubuntu16",permalink:"/notebook/docs/MySQL/Cluster/How-To-Create-a-Multi-Node-MySQL-Cluster-on-Ubuntu16",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/MySQL/Cluster/How To Create a Multi-Node MySQL Cluster on Ubuntu16.md",tags:[],version:"current",frontMatter:{slug:"How-To-Create-a-Multi-Node-MySQL-Cluster-on-Ubuntu16"},sidebar:"tutorialSidebar",previous:{title:"kinamo_mysqlbackup",permalink:"/notebook/docs/MySQL/Backup/kinamo_mysqlbackup"},next:{title:"How to Install and Configure MySQL Cluster on CentOS 7",permalink:"/notebook/docs/MySQL/Cluster/How-to-Install-and-Configure-MySQL-Cluster-on-CentOS-7"}},i={},u=[],c={toc:u};function m(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"how-to-create-a-multi-node-mysql-cluster-on-ubuntu-1604"},"How To Create a Multi-Node MySQL Cluster on Ubuntu 16.04"),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-create-a-multi-node-mysql-cluster-on-ubuntu-16-04"},"link")),(0,l.kt)("p",null,"Posted June 17, 2016"),(0,l.kt)("p",null,"##Introduction"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"In short, there is one or more management nodes which control the data nodes (where data is stored). "),(0,l.kt)("li",{parentName:"ul"},"After consulting with the management node, clients (MySQL clients, servers, or native APIs) connect directly to the data nodes."),(0,l.kt)("li",{parentName:"ul"},"With the cluster there is no typical replication of data, but instead there is synchronization of the data nodes."),(0,l.kt)("li",{parentName:"ul"},"a special data engine must be used \u2014 NDBCluster (NDB)"),(0,l.kt)("li",{parentName:"ul"},"Think of the cluster as a single logical MySQL environment with redundant components"),(0,l.kt)("li",{parentName:"ul"},"a MySQL cluster can participate in replication with other MySQL clusters.")),(0,l.kt)("p",null,"A simple MySQL Cluster"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"MySQL Server & Cluster Management Server: manager.mysql.cluster"),(0,l.kt)("li",{parentName:"ul"},"Cluster Node 1: node1.mysql.cluster"),(0,l.kt)("li",{parentName:"ul"},"Cluster Node 2: node2.mysql.cluster")),(0,l.kt)("p",null,"##Prerequisites"),(0,l.kt)("p",null,"We will need a total of three Droplets"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"one Droplet for the MySQL cluster manager and the MySQL server/client"),(0,l.kt)("li",{parentName:"ul"},"two Droplets for the redundant MySQL data nodes.")),(0,l.kt)("p",null,"In the same DigitalOcean data center, create the following Droplets with private networking enabled:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Three Ubuntu 16.04 Droplets with a minimum of 1 GB RAM and private networking enabled"),(0,l.kt)("li",{parentName:"ul"},"Non-root user with sudo privileges for each Droplet (Initial Server Setup with Ubuntu 16.04 explains how to set this up.)")),(0,l.kt)("p",null,"MySQL cluster stores a lot of information in RAM. Each Droplet should have at least 1GB of RAM."),(0,l.kt)("p",null,"for each Droplet in the /etc/hosts file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"10.XXX.XX.X node1.mysql.cluster\n10.YYY.YY.Y node2.mysql.cluster\n10.ZZZ.ZZ.Z manager.mysql.cluster\n")),(0,l.kt)("p",null,"##Step 1 \u2014 Downloading and Installing MySQL Cluster"),(0,l.kt)("p",null,"At the time of writing this tutorial, the latest GPL version of the MySQL cluster is 7.4.11. The product is built on top of MySQL 5.6 and it includes:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Cluster manager software"),(0,l.kt)("li",{parentName:"ul"},"Data node manager software"),(0,l.kt)("li",{parentName:"ul"},"MySQL 5.6 server and client binaries")),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"The installation instructions will be the same for all Droplets, so complete these steps on all 3 Droplets")),(0,l.kt)("p",null,"Before you start the installation, the libaio1 package must be installed since it is a dependency:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo apt-get install libaio1\n")),(0,l.kt)("p",null,"After that, install the MySQL cluster package:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo dpkg -i mysql-cluster-gpl-7.4.11-debian7-x86_64.deb\n")),(0,l.kt)("p",null,"Now you can find the MySQL cluster installation in the directory ",(0,l.kt)("em",{parentName:"p"},"/opt/mysql/server-5.6/"),". We'll be working especially with the bin directory (",(0,l.kt)("em",{parentName:"p"},"/opt/mysql/server-5.6/bin/"),") where all the binaries are."),(0,l.kt)("p",null,"##Step 2 \u2014 Configuring and Starting the Cluster Manager"),(0,l.kt)("p",null,"On the manager.mysql.cluster Droplet, first create the directory where this file will reside (/var/lib/mysql-cluster):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo mkdir /var/lib/mysql-cluster\nsudo nano /var/lib/mysql-cluster/config.ini\n")),(0,l.kt)("p",null,"/var/lib/mysql-cluster/config.ini"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"[ndb_mgmd]\n# Management process options:\nhostname=manager.mysql.cluster  # Hostname of the manager\ndatadir=/var/lib/mysql-cluster  # Directory for the log files\n\n[ndbd]\nhostname=node1.mysql.cluster    # Hostname of the first data node\ndatadir=/usr/local/mysql/data   # Remote directory for the data files\n\n[ndbd]\nhostname=node2.mysql.cluster    # Hostname of the second data node\ndatadir=/usr/local/mysql/data   # Remote directory for the data files\n\n[mysqld]\n# SQL node options:\nhostname=manager.mysql.cluster  # In our case the MySQL server/client is on the same Droplet as the cluster manager\n")),(0,l.kt)("p",null,"Now you can start the manager for the first time by executing the ndb_mgmd binary and specifying the config file with the -f argument like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo /opt/mysql/server-5.6/bin/ndb_mgmd -f /var/lib/mysql-cluster/config.ini\n")),(0,l.kt)("p",null,"have the management service started automatically with the server. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo systemctl enable rc-local.service\nsudo nano /etc/rc.local\n")),(0,l.kt)("p",null,"/etc/rc.local"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"...\n/opt/mysql/server-5.6/bin/ndb_mgmd -f /var/lib/mysql-cluster/config.ini\nexit 0\n")),(0,l.kt)("p",null,"##Step 3 \u2014 Configuring and Starting the Data Nodes"),(0,l.kt)("p",null,"Next we'll configure the data nodes (node1.mysql.cluster and node2.mysql.cluster) to store the data files and support properly the NDB engine. All commands should be executed on both nodes."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo nano /etc/my.cnf\n")),(0,l.kt)("p",null,"/etc/my.cnf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"[mysql_cluster]\nndb-connectstring=manager.mysql.cluster\n")),(0,l.kt)("p",null,"Specifying the location of the manager is the only configuration needed for the node engine to start. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo mkdir -p /usr/local/mysql/data\nsudo /opt/mysql/server-5.6/bin/ndbd\n")),(0,l.kt)("p",null,"You should have the ndbd service started automatically with the server. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo systemctl enable rc-local.service\nsudo nano /etc/rc.local\n")),(0,l.kt)("p",null,"/etc/rc.local"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"...\n/opt/mysql/server-5.6/bin/ndbd\nexit 0\n")),(0,l.kt)("p",null,"##Step 4 \u2014 Configuring and Starting the MySQL Server and Client"),(0,l.kt)("p",null,"A standard MySQL server, such as the one that is available in Ubuntu's default apt repository, does not support the MySQL cluster engine NDB."),(0,l.kt)("p",null,"we'll use the MySQL server and client on the management node (manager.mysql.cluster)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo nano /etc/my.cnf\n")),(0,l.kt)("p",null,"/etc/my.cnf"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"[mysqld]\nndbcluster # run NDB storage engine\n")),(0,l.kt)("p",null,"As per the best practices, the MySQL server should run under its own user (mysql) which belongs to its own group (again mysql). So let's create first the group:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo groupadd mysql\n")),(0,l.kt)("p",null,"Then create the mysql user belonging to this group and make sure it cannot use shell by setting its shell path to /bin/false like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo useradd -r -g mysql -s /bin/false mysql\n")),(0,l.kt)("p",null,"The last requirement for the custom MySQL server installation is to create the default database. You can do it with the command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo /opt/mysql/server-5.6/scripts/mysql_install_db --user=mysql\n")),(0,l.kt)("p",null,"For starting the MySQL server we'll use the startup script from /opt/mysql/server-5.6/support-files/mysql.server. Copy it to the default init scripts directory under the name mysqld like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo cp /opt/mysql/server-5.6/support-files/mysql.server /etc/init.d/mysqld\n")),(0,l.kt)("p",null,"Enable the startup script and add it to the default runlevels with the command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo systemctl enable mysqld.service\n")),(0,l.kt)("p",null,"Now we can start the MySQL server for the first time manually with the command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo systemctl start mysqld\n")),(0,l.kt)("p",null,"As a MySQL client we'll use again the custom binary which comes with the cluster installation. It has the following path: /opt/mysql/server-5.6/bin/mysql. For convenience let's create a symbolic link to it in the default /usr/bin path:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo ln -s /opt/mysql/server-5.6/bin/mysql /usr/bin/\n")),(0,l.kt)("p",null,"Now you can start the client from the command line by simply typing mysql like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"mysql\n    Output of ndb_mgmd\n    Welcome to the MySQL monitor.  Commands end with ; or \\g.\n    Your MySQL connection id is 3\n    Server version: 5.6.29-ndb-7.4.11-cluster-gpl MySQL Cluster Community Server (GPL)\n")),(0,l.kt)("p",null,"To exit the MySQL prompt, simply type quit or press simultaneously CTRL-D."),(0,l.kt)("p",null,"##Testing the Cluster"),(0,l.kt)("p",null,"At this point our simple MySQL cluster with one client, one server, one manager, and two data nodes should be complete."),(0,l.kt)("p",null,"From the cluster manager Droplet (manager.mysql.cluster) open the management console with the command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"sudo /opt/mysql/server-5.6/bin/ndb_mgm\n    Inside the ndb_mgm console\n    -- NDB Cluster -- Management Client --\n    ndb_mgm> SHOW\n        Output of ndb_mgm\n        Connected to Management Server at: manager.mysql.cluster:1186\n        Cluster Configuration\n        ---------------------\n        [ndbd(NDB)]     2 node(s)\n        id=2    @10.135.27.42  (mysql-5.6.29 ndb-7.4.11, Nodegroup: 0, *)\n        id=3    @10.135.27.43  (mysql-5.6.29 ndb-7.4.11, Nodegroup: 0)\n        [ndb_mgmd(MGM)] 1 node(s)\n        id=1    @10.135.27.51  (mysql-5.6.29 ndb-7.4.11)\n        [mysqld(API)]   1 node(s)\n        id=4    @10.135.27.51  (mysql-5.6.29 ndb-7.4.11)\n    ndb_mgm> 2 STATUS\n    ndb_mgm> quit     \n")),(0,l.kt)("p",null,"The management console is very powerful and gives you many other options for managing the cluster and its data, including creating an online backup. For more information check the ",(0,l.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.6/en/mysql-cluster-management.html"},"official documentation"),"."),(0,l.kt)("p",null,"Let's have a test with the MySQL client now. From the same Droplet, start the client with the mysql command for the MySQL root user. Please recall that we have created a symlink to it earlier."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"mysql -u root\n    mysql> SHOW ENGINE NDB STATUS \\G\n        Output of mysql\n        *************************** 1. row ***************************\n          Type: ndbcluster\n          Name: connection\n        Status: cluster_node_id=4, connected_host=manager.mysql.cluster, connected_port=1186, number_of_data_nodes=2, number_of_ready_data_nodes=2, connect_count=0\n        ...\n")),(0,l.kt)("p",null,"You can try shutting down one of the data nodes in order to test the cluster stability. The simplest thing would be just to restart the whole Droplet in order to have a full test of the recovery process. You will see the value of number_of_ready_data_nodes change to 1 and back to 2 again as the node is restarted."),(0,l.kt)("p",null,"##Working with the NDB Engine"),(0,l.kt)("p",null,"To see how the cluster really works, let's create a new table with the NDB engine, We have explicitly specified above the engine ndbcluster in order to make use of the cluster."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"mysql> CREATE DATABASE cluster;\nmysql> USE cluster;\nmysql> CREATE TABLE cluster_test (name VARCHAR(20), value VARCHAR(20)) ENGINE=ndbcluster;\nmysql> INSERT INTO cluster_test (name,value) VALUES('some_name','some_value');\nmysql> SELECT * FROM cluster_test;\n")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://dev.mysql.com/doc/refman/5.6/en/mysql-cluster.html"},"https://dev.mysql.com/doc/refman/5.6/en/mysql-cluster.html")))}m.isMDXComponent=!0}}]);