"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[23132],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>d});var r=n(67294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,r,l=function(e,t){if(null==e)return{};var n,r,l={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var i=r.createContext({}),u=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(i.Provider,{value:t},e.children)},p="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,l=e.mdxType,o=e.originalType,i=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),p=u(n),m=l,d=p["".concat(i,".").concat(m)]||p[m]||g[m]||o;return n?r.createElement(d,s(s({ref:t},c),{},{components:n})):r.createElement(d,s({ref:t},c))}));function d(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var o=n.length,s=new Array(o);s[0]=m;var a={};for(var i in t)hasOwnProperty.call(t,i)&&(a[i]=t[i]);a.originalType=e,a[p]="string"==typeof e?e:l,s[1]=a;for(var u=2;u<o;u++)s[u]=n[u];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1779:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>a,toc:()=>u});var r=n(87462),l=(n(67294),n(3905));const o={},s="LMS SSO integration",a={unversionedId:"Symfony/Authentication/SAML/keycloak/LMS SSO integration",id:"Symfony/Authentication/SAML/keycloak/LMS SSO integration",title:"LMS SSO integration",description:"Bundle",source:"@site/docs/Symfony/Authentication/SAML/keycloak/LMS SSO integration.md",sourceDirName:"Symfony/Authentication/SAML/keycloak",slug:"/Symfony/Authentication/SAML/keycloak/LMS SSO integration",permalink:"/notebook/docs/Symfony/Authentication/SAML/keycloak/LMS SSO integration",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/Symfony/Authentication/SAML/keycloak/LMS SSO integration.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Who use lightSaml",permalink:"/notebook/docs/Symfony/Authentication/SAML/Who use lightSaml"},next:{title:"packagist saml",permalink:"/notebook/docs/Symfony/Authentication/SAML/packagist-saml"}},i={},u=[{value:"Bundle",id:"bundle",level:2},{value:"SSO serveur",id:"sso-serveur",level:2},{value:"Fichiers et codes",id:"fichiers-et-codes",level:2},{value:"Routes",id:"routes",level:2},{value:"Saml Configs",id:"saml-configs",level:2},{value:"Security Configs",id:"security-configs",level:2}],c={toc:u};function p(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"lms-sso-integration"},"LMS SSO integration"),(0,l.kt)("h2",{id:"bundle"},"Bundle"),(0,l.kt)("p",null,'on utilise "lightsaml/sp-bundle":'),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ composer require lightsaml/sp-bundle\n")),(0,l.kt)("h2",{id:"sso-serveur"},"SSO serveur"),(0,l.kt)("p",null,"on utilise keycloak comme le serveur SSO"),(0,l.kt)("h2",{id:"fichiers-et-codes"},"Fichiers et codes"),(0,l.kt)("p",null,"les fichiers sont ajout\xe9s: "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"src/Store/IdStore.php #une service"),(0,l.kt)("li",{parentName:"ul"},"src/Security/UserCreator.php #pour cr\xe9er l'utilisateur ou mettre \xe0 jour l'utilisateur"),(0,l.kt)("li",{parentName:"ul"},"src/Entity/IdEntry.php #pour stocker les sessions envoies par le serveur SSO "),(0,l.kt)("li",{parentName:"ul"},"src/Service/SamlLogoutHandler.php #pour SSO logout, mais on ne le servie pas ")),(0,l.kt)("p",null,"les fichiers \xe0 modifier: "),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"src/Controller/HomeController #pas de redirection vers fos user login, afficher sso login, fos user login il faut taper \xe0 la main.  ")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-php"},"    // code origine\n    //return $this->redirect($this->generateUrl('fos_user_security_login')); \n    \n    // codes ajout\xe9s\n    return $this->render('@FOSUser/Security/login.html.twig', [ \n        'last_username' => '',\n        'error' => null\n    ]);\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"templates/bundles/FOSUserBundle/Security/login_content.html.twig #afficher le formulaire ou le button selon le url")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-twig"},'{% if \'app_login\' in app.request.attributes.get(\'_route\') %} \n    ...(codes originaux)\n{% else %}\n    <div class="alert alert-icon lms-alert-danger alert-dismissible mt-3" role="alert">\n        <button data-dismiss="alert" class="close"></button>\n        <a href="{{ path(\'lightsaml_sp.login\') }}" class="lms-button lms-button-red">SSO Login</a>\n    </div>\n{% endif %}\n')),(0,l.kt)("h2",{id:"routes"},"Routes"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"config/routes/lightsaml_sp.yaml # \xe0 ajouter")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"lightsaml_sp.logout:\n   path: /saml/logout   \n\nlightsaml_sp.metadata:\n    path: /saml/metadata.xml\n    defaults: { _controller: LightSaml\\SpBundle\\Controller\\DefaultController::metadataAction }\n\nlightsaml_sp.discovery:\n    path: /saml/discovery\n    defaults: { _controller: LightSaml\\SpBundle\\Controller\\DefaultController::discoveryAction }\n\nlightsaml_sp.login:\n    path: /saml/login\n    defaults: { _controller: LightSaml\\SpBundle\\Controller\\DefaultController::loginAction}\n\nlightsaml_sp.login_check:\n    path: /saml/login_check\n\nlightsaml_sp.sessions:\n    path: /saml/sessions\n    defaults: { _controller: LightSaml\\SpBundle\\Controller\\DefaultController::sessionsAction }   \n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"config/routes/fos_user.yml # \xe0 modifier")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"app_login: \n    path: /fr/login\n    defaults: { _controller: App\\Controller\\SecurityController::login } \n\napp_login_en: \n    path: /en/login\n    defaults: { _controller: App\\Controller\\SecurityController::login } \n\nfos_user_security_login: \n    path: /fr/login\n    defaults: { _controller: FOSUserBundle:Security:login } \n\nfos_user_security_login_en: \n    path: /en/login\n    defaults: { _controller: FOSUserBundle:Security:login } \n\nfos_user_security_check:\n    path: /fr/login_check\n    defaults: { _controller: FOSUserBundle:Security:check } \n\nfos_user_security_check_en:\n    path: /en/login_check\n    defaults: { _controller: FOSUserBundle:Security:check } \n\nfos_user_security_logout:\n    path: /fr/logout\n    defaults: { _controller: FOSUserBundle:Security:logout } \n\nfos_user_security_logout_en:\n    path: /fr/logout\n    defaults: { _controller: FOSUserBundle:Security:logout } \n\nfos_user_change_password:\n    path: /{_locale}/change-password\n    defaults: { _controller: FOSUserBundle:ChangePassword:changePassword } \n\nfos_user_resetting_request:\n    path: /{_locale}/request\n    defaults: { _controller: FOSUserBundle:Resetting:request } \n\nfos_user_resetting_check_email:\n    path: /{_locale}/check-email\n    defaults: { _controller: FOSUserBundle:Resetting:checkEmail } \n\nfos_user_resetting_reset:\n    path: /{_locale}/reset/{token}\n    defaults: { _controller: FOSUserBundle:Resetting:reset } \n\nfos_user_profile_edit:\n    path: /{_locale}/profile/edit\n    defaults: { _controller: FOSUserBundle:Profile:edit } \n\nfos_user_profile_show:\n    path: /{_locale}/profile\n    defaults: { _controller: FOSUserBundle:Profile:show } \n")),(0,l.kt)("h2",{id:"saml-configs"},"Saml Configs"),(0,l.kt)("p",null,"trois fichiers \xe0 ajouter"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"config/saml/saml-idp.xml #serveur SSO identificator XML"),(0,l.kt)("li",{parentName:"ul"},"config/saml/saml.crt #certificat, le m\xeame que sur le serveur SSO"),(0,l.kt)("li",{parentName:"ul"},"config/saml/saml.key #cl\xe9 priv\xe9, le m\xeame que sur le serveur SSO")),(0,l.kt)("h2",{id:"security-configs"},"Security Configs"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},'    firewalls:\n        dev:\n            pattern: ^/(_(profiler|wdt)|css|images|js)/\n            security: false\n\n        #config origin \xe0 d\xe9sactiver\n        # Firewall pour les pages de connexion, et r\xe9cup\xe9ration de mot de passe\n        # login:\n        #     pattern:   ^/%locale%/(login$|resetting|register|signature$)  # Les adresses de ces pages sont login, et resetting\n        #     anonymous: true                          # On autorise bien \xe9videmment les anonymes sur ces pages !\n        #     #logout_on_user_change: true\n\n        main:\n            anonymous: ~\n            \n            # config origin \xe0 d\xe9sactiver\n            # form_login: \n            #     provider: fos_userbundle #users\n            #     #remember_me: true \n            #     login_path: app_login #fos_user_security_login\n            #     check_path: app_login #fos_user_security_check\n            #     #use_forward: false\n            #     default_target_path: /%locale%/\n            #     csrf_token_generator: security.csrf.token_manager\n\n            light_saml_sp:\n                provider: fos_userbundle\n                user_creator: App\\Security\\UserCreator\n                login_path: /saml/login\n                check_path: /saml/login_check\n                default_target_path: /\n                require_previous_session: true\n\n            logout:   \n                path: fos_user_security_logout\n                target: /\n\n            #config origin \xe0 d\xe9sactiver\n            # remember_me:\n            #     secret:  "%env(APP_SECRET)%" \n            #     lifetime: 31536000 # 365 jours en secondes\n            #     path:   /\n            # guard: \n            #     authenticators:\n            #         - App\\Security\\LoginFormAuthenticator\n')))}p.isMDXComponent=!0}}]);