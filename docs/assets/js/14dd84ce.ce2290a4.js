"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[79307],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,f=u["".concat(l,".").concat(m)]||u[m]||p[m]||s;return n?a.createElement(f,i(i({ref:t},d),{},{components:n})):a.createElement(f,i({ref:t},d))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=m;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var c=2;c<s;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},83649:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var a=n(87462),r=(n(67294),n(3905));const s={slug:"LMS-SSO-Configuration-and-Tests",title:"LMS SSO Configuration and Tests",authors:["yshen"],tags:["SSO","Configuration"]},i=void 0,o={permalink:"/notebook/blog/LMS-SSO-Configuration-and-Tests",editUrl:"https://github.com/scheffershen/notebook/tree/main/blog/2022-12-04 LMS SSO Configuration and Tests/index.md",source:"@site/blog/2022-12-04 LMS SSO Configuration and Tests/index.md",title:"LMS SSO Configuration and Tests",description:"What is SSO ?",date:"2022-12-04T00:00:00.000Z",formattedDate:"December 4, 2022",tags:[{label:"SSO",permalink:"/notebook/blog/tags/sso"},{label:"Configuration",permalink:"/notebook/blog/tags/configuration"}],readingTime:4.11,hasTruncateMarker:!1,authors:[{name:"Yi Shen",title:"Web Developer",url:"https://github.com/scheffershen",imageURL:"https://github.com/scheffershen.png",key:"yshen"}],frontMatter:{slug:"LMS-SSO-Configuration-and-Tests",title:"LMS SSO Configuration and Tests",authors:["yshen"],tags:["SSO","Configuration"]},prevItem:{title:"Guide de migration vers Ubuntu 22.04, PHP 7.4, MySQL 8",permalink:"/notebook/blog/Guide-de-migration-vers-Ubuntu-22.04-PHP-7.4-MySQL-8"},nextItem:{title:"Guide du d\xe9veloppeur",permalink:"/notebook/blog/guide-developpeur"}},l={authorsImageUrls:[void 0]},c=[{value:"What is SSO ?",id:"what-is-sso-",level:4},{value:"What is SAML ?",id:"what-is-saml-",level:4},{value:"What is EuroPharma LMS ?",id:"what-is-europharma-lms-",level:4},{value:"How is EuroPharmaLMS SSO configured ?",id:"how-is-europharmalms-sso-configured-",level:4},{value:"How to generate a certificate for the SAML application?",id:"how-to-generate-a-certificate-for-the-saml-application",level:4},{value:"How are the tests performed ?",id:"how-are-the-tests-performed-",level:4}],d={toc:c};function u(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h4",{id:"what-is-sso-"},"What is SSO ?"),(0,r.kt)("p",null,"Single sign-on (SSO) is a technology that provide the user authentication service that permits a user to use one set of login credentials, for example, a username and password, to access all of their SaaS applications.\nSingle sign on would allow the enterprise system to securely store and own all of the user credentials. The platform then  establishes a trust relationship with the enterprise authentication server and client applications can be built to make the most of the trusted auth server to authenticate users."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Single sign-on",src:n(65306).Z,width:"575",height:"606"})),(0,r.kt)("h4",{id:"what-is-saml-"},"What is SAML ?"),(0,r.kt)("p",null,"Security Assertion Markup Language (SAML) is a protocol that enables SSO and follows a standardized way to verify the users\u2019 credentials once and updates other applications about the user\u2019s identity. "),(0,r.kt)("p",null,"The protocol involves a user, an identity provider and a service provider to authenticate and transfer data between the parties.\nLet\u2019s say you work for a company and they provided credentials to access the dashboard. The dashboard includes various external services. When you click on any external service, you automatically sign in to another web application without filling in any credentials. All this happened because of the SAML. The protocol uses XML based authentication to transfer a user\u2019s identity between the IdP and SP. IdP, also known as Identity Provider, is responsible for authenticating and sharing identity data to SP.\nSP (ex : demo.lms.fr), also known as Service Provider, receives the validated information from the IdP (ex :  PingOne server) and authorizes the user to access the external service or resources. Overall, with the help of SAML, any user with a valid account can access resources from multiple applications."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"SAML",src:n(97007).Z,width:"605",height:"334"})),(0,r.kt)("h4",{id:"what-is-europharma-lms-"},"What is EuroPharma LMS ?"),(0,r.kt)("p",null,"Europharma learning management system (LMS) is a web-based application that delivers online courses to your employees. It uses PHP 7 language, Symfony 4 Framework and MySql 8 database and runs on Ubuntu 20.04 server."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"config saml",src:n(48504).Z,width:"731",height:"130"})),(0,r.kt)("h4",{id:"how-is-europharmalms-sso-configured-"},"How is EuroPharmaLMS SSO configured ?"),(0,r.kt)("p",null,"We are using the LightSAML Core PHP library, LightSAML Core is a PHP library implementing OASIS SAML 2.0 protocol, fully OOP structured with DPI principles, reusable, and embeddable."),(0,r.kt)("p",null,"SAML signing and encryption uses certificates (ex : ",(0,r.kt)("inlineCode",{parentName:"p"},"saml.crt"),"), to verify data sent between the Service Provider (SP, demo.lms.fr) and  PingOne Identity Provider (IdP,  PingOne). SAML certificates are distinct from SSL (TSL) certificates, which apply to the application's browser and are configured and maintained by the server.\nThe IdP ( PingOne Identity) server generates a metadata file (saml-idp.xml) that contains configuration and integration details for SAML 2.0 single sign-on. This file is used by SP (demo.lms.fr). "),(0,r.kt)("h4",{id:"how-to-generate-a-certificate-for-the-saml-application"},"How to generate a certificate for the SAML application?"),(0,r.kt)("p",null,"Run the command given below :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ openssl req -new -x509 -days 365 -nodes -sha256 -out saml.crt -keyout saml.key\n")),(0,r.kt)("p",null,"You will find the public certificate in ",(0,r.kt)("inlineCode",{parentName:"p"},"saml.crt")," and private key in ",(0,r.kt)("inlineCode",{parentName:"p"},"saml.key")," file in the current directory."),(0,r.kt)("h4",{id:"how-are-the-tests-performed-"},"How are the tests performed ?"),(0,r.kt)("p",null,"We use ",(0,r.kt)("inlineCode",{parentName:"p"},"KeyCloak")," for demo Idp provider. ",(0,r.kt)("inlineCode",{parentName:"p"},"Keycloak")," is an open-source identity and access management tool.\nBelow is the configuration file in json format for lms client :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n      "id": "a0273a0d-08ba-4ded-941d-6166d63b42b6",\n      "clientId": "https://demo.lms.fr/saml/login_check",\n      "surrogateAuthRequired": false,\n      "enabled": true,\n      "alwaysDisplayInConsole": false,\n      "clientAuthenticatorType": "client-secret",\n      "secret": "**********",\n      "redirectUris": [],\n      "webOrigins": [],\n      "notBefore": 0,\n      "bearerOnly": false,\n      "consentRequired": false,\n      "standardFlowEnabled": true,\n      "implicitFlowEnabled": false,\n      "directAccessGrantsEnabled": false,\n      "serviceAccountsEnabled": false,\n      "publicClient": false,\n      "frontchannelLogout": true,\n      "protocol": "saml",\n      "attributes": {\n        "saml_assertion_consumer_url_redirect": "https://demo.lms.fr/saml/login_check",\n        "saml.force.post.binding": "true",\n        "saml.multivalued.roles": "false",\n        "backchannel.logout.revoke.offline.tokens": "false",\n        "saml.server.signature.keyinfo.ext": "false",\n        "saml.signing.certificate": "MIIC0TCCAbkCBgF45cfeLD",\n        "backchannel.logout.session.required": "false",\n        "client_credentials.use_refresh_token": "false",\n        "saml.signature.algorithm": "RSA_SHA256",\n        "saml.client.signature": "true",\n        "saml.signing.private.key": "MIIEowIBAAKCAQEAnUwWICyeHfzA0",\n        "saml.assertion.signature": "true",\n        "saml_single_logout_service_url_post": "https://demo.lms.fr",\n        "saml.encrypt": "false",\n        "saml_assertion_consumer_url_post": "https://demo.lms.fr/saml/login_check",\n        "saml.server.signature": "true",\n        "exclude.session.state.from.auth.response": "false",\n        "saml_single_logout_service_url_redirect": "https://demo.lms.fr",\n        "saml_force_name_id_format": "false",\n        "tls.client.certificate.bound.access.tokens": "false",\n        "saml.authnstatement": "true",\n        "display.on.consent.screen": "false",\n        "saml_name_id_format": "username",\n        "saml.onetimeuse.condition": "false",\n        "saml_signature_canonicalization_method": "http://www.w3.org/2001/10/xml-exc-c14n#"\n      },\n      "authenticationFlowBindingOverrides": {},\n      "fullScopeAllowed": true,\n      "nodeReRegistrationTimeout": -1,\n      "protocolMappers": [\n        {\n          "id": "860362af-3c90-4e95-af9e-d3e338dcba45",\n          "name": "X500 surname",\n          "protocol": "saml",\n          "protocolMapper": "saml-user-property-mapper",\n          "consentRequired": false,\n          "config": {\n            "attribute.nameformat": "urn:oasis:names:tc:SAML:2.0:attrname-format:uri",\n            "user.attribute": "lastName",\n            "friendly.name": "surname",\n            "attribute.name": "urn:oid:2.5.4.4"\n          }\n        },\n        {\n          "id": "7b3b074e-590b-4cc0-8c8c-1663adcbc55b",\n          "name": "X500 email",\n          "protocol": "saml",\n          "protocolMapper": "saml-user-property-mapper",\n          "consentRequired": false,\n          "config": {\n            "attribute.nameformat": "urn:oasis:names:tc:SAML:2.0:attrname-format:uri",\n            "user.attribute": "email",\n            "friendly.name": "email",\n            "attribute.name": "urn:oid:1.2.840.113549.1.9.1"\n          }\n        },\n        {\n          "id": "865ed0f8-3059-458f-bdfb-cdde874ad4ae",\n          "name": "X500 givenName",\n          "protocol": "saml",\n          "protocolMapper": "saml-user-property-mapper",\n          "consentRequired": false,\n          "config": {\n            "attribute.nameformat": "urn:oasis:names:tc:SAML:2.0:attrname-format:uri",\n            "user.attribute": "firstName",\n            "friendly.name": "givenName",\n            "attribute.name": "urn:oid:2.5.4.42"\n          }\n        },\n        {\n          "id": "36d50ebe-db8a-4aec-8a78-7d3d628c6e86",\n          "name": "X500 ID",\n          "protocol": "saml",\n          "protocolMapper": "saml-user-property-mapper",\n          "consentRequired": false,\n          "config": {\n            "user.attribute": "id",\n            "friendly.name": "id",\n            "attribute.name": "urn:oid:1.2.840.113549.1.9.1"\n          }\n        },\n        {\n          "id": "5aaf212b-ffb6-49c6-94dd-dbc896228f18",\n          "name": "role list",\n          "protocol": "saml",\n          "protocolMapper": "saml-role-list-mapper",\n          "consentRequired": false,\n          "config": {\n            "single": "false",\n            "attribute.nameformat": "Basic",\n            "attribute.name": "Role"\n          }\n        }\n      ],\n      "defaultClientScopes": [\n        "web-origins",\n        "role_list",\n        "profile",\n        "roles",\n        "email"\n      ],\n      "optionalClientScopes": [\n        "address",\n        "phone",\n        "offline_access",\n        "microprofile-jwt"\n      ]\n    },\n')),(0,r.kt)("p",null,"Below is lms client general information page : "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"General",src:n(40662).Z,width:"756",height:"405"})),(0,r.kt)("p",null,"And it\u2019s Idp xml :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Idp xml",src:n(2922).Z,width:"756",height:"215"})),(0,r.kt)("p",null,"And lms client settings : "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"setting",src:n(47618).Z,width:"756",height:"481"})),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"setting",src:n(72008).Z,width:"756",height:"482"})),(0,r.kt)("p",null,"And it\u2019s the public certificate and the private key :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"key",src:n(65770).Z,width:"756",height:"373"})),(0,r.kt)("p",null,"Now we created a test user account : "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"account",src:n(4327).Z,width:"756",height:"428"})),(0,r.kt)("p",null,"And we checked it "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"lms",src:n(62926).Z,width:"756",height:"440"})),(0,r.kt)("p",null,"Clicked on the login SSO button :"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"sso login",src:n(41265).Z,width:"756",height:"445"})),(0,r.kt)("p",null,"We arrived Idp login page, with the test user login (",(0,r.kt)("a",{parentName:"p",href:"mailto:lambda@lambda.com"},"lambda@lambda.com"),") and password (azerty), we successfully retourned to SP(demo.lms.fr)."))}u.isMDXComponent=!0},4327:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/account-d44828412b5d730c380669e51e4b394a.png"},48504:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/config_saml-48f1d07460a971b98192f20147c695cd.png"},2922:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/idp-xml-925db4eb6d8bd964564c813be590386b.png"},40662:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/lms-client-general-0e2e56c862d2fc19f9a2849ff99b59f9.png"},65770:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/lms-client-key-471b40517a15a8c6f7149fa4e9157a0c.png"},72008:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/lms-client-setting-2-0a7f21a4cf5e2673cac75ca87507b965.png"},47618:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/lms-client-setting-65558ae01defb48f77efe6e22a0da587.png"},62926:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/lms-4c12b7fce70c73098a19724288792d88.png"},97007:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/saml-c75759575dc2fe9e2e57ab7740635975.png"},65306:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/single-sign-on-1e856d48b74b199024cdc10272275bbf.png"},41265:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/sso-login-e40d738b3ccad6408578532f6c84d0bd.png"}}]);