"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[33631],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",k={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),c=u(n),h=o,d=c["".concat(s,".").concat(h)]||c[h]||k[h]||a;return n?r.createElement(d,l(l({ref:t},p),{},{components:n})):r.createElement(d,l({ref:t},p))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=h;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:o,l[1]=i;for(var u=2;u<a;u++)l[u]=n[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},43700:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>a,metadata:()=>i,toc:()=>u});var r=n(87462),o=(n(67294),n(3905));const a={},l="Third-party authentication - Client-side",i={unversionedId:"Symfony/Authentication/Oauth/Claroline/doc/sections/oauth/client-side",id:"Symfony/Authentication/Oauth/Claroline/doc/sections/oauth/client-side",title:"Third-party authentication - Client-side",description:"Registration",source:"@site/docs/Symfony/Authentication/Oauth/Claroline/doc/sections/oauth/client-side.md",sourceDirName:"Symfony/Authentication/Oauth/Claroline/doc/sections/oauth",slug:"/Symfony/Authentication/Oauth/Claroline/doc/sections/oauth/client-side",permalink:"/notebook/docs/Symfony/Authentication/Oauth/Claroline/doc/sections/oauth/client-side",draft:!1,editUrl:"https://github.com/scheffershen/notebook/tree/main/docs/Symfony/Authentication/Oauth/Claroline/doc/sections/oauth/client-side.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"OAuthBundle",permalink:"/notebook/docs/Symfony/Authentication/Oauth/Claroline/doc/oauth/"},next:{title:"Claroline Oauth",permalink:"/notebook/docs/Symfony/Authentication/Oauth/Claroline_oauth"}},s={},u=[{value:"Registration",id:"registration",level:2},{value:"Request format",id:"request-format",level:2},{value:"Authorization Code flow",id:"authorization-code-flow",level:2},{value:"Implicit Grant flow",id:"implicit-grant-flow",level:2},{value:"Password flow",id:"password-flow",level:2},{value:"Client Credentials flow",id:"client-credentials-flow",level:2},{value:"Refresh flow",id:"refresh-flow",level:2}],p={toc:u};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"third-party-authentication---client-side"},"Third-party authentication - Client-side"),(0,o.kt)("h2",{id:"registration"},"Registration"),(0,o.kt)("p",null,"Third-party application that need access to the platform will first need to be register in it."),(0,o.kt)("p",null,"To do so a command line utility is available:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},'php app/console claroline:client:create --redirect-uri="http://www.example.com/" --grant-type="authorization_code" --grant-type="password" --grant-type="refresh_token" --grant-type="token" --grant-type="client_credentials" client_name\n')),(0,o.kt)("p",null,"If everything went fine you should get a response from the command with something like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Added a new client with public id 4_3cpk8blr9fswcggkc4gkkgok0oc0kgc8sw4gk80ksso4040wcs, secret np3j4uvzxs0wo4wk4ccggococ0k84kog8gs0so0c840oggos4\n")),(0,o.kt)("p",null,"In this example we created a client with all possible grant types allowed, but for real use case maybe just the one needed will be enough.\nThe redirect uri represents a URL, where your client application is deployed.\nYou will get redirected here if everything went as planned, when redirection is involved in the authorization process."),(0,o.kt)("p",null,"This public_id and secret have to be given to the third-party applciation developers as they'll need it for further request."),(0,o.kt)("p",null,"There are multiple flow to authenticate third-party application.\n",(0,o.kt)("inlineCode",{parentName:"p"},"Token")," flow is the only one needed to allow third-party application to access the platform, the other served to authenticate and authorize it."),(0,o.kt)("h2",{id:"request-format"},"Request format"),(0,o.kt)("p",null,"All request can be ",(0,o.kt)("inlineCode",{parentName:"p"},"get")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"post")," request, it's up to you."),(0,o.kt)("p",null,"When data is returned it's always in ",(0,o.kt)("inlineCode",{parentName:"p"},"json"),"."),(0,o.kt)("h2",{id:"authorization-code-flow"},"Authorization Code flow"),(0,o.kt)("p",null,"That\u2019s the most commonly used one, recommended to authorize end customers.\nA good example is the Facebook Login for websites. Here\u2019s how it works."),(0,o.kt)("p",null,"The Authorization Code flow generates an authorization code when the user grants access and the OAuth2 client needs to make a subsequent request to get the access and refresh tokens."),(0,o.kt)("p",null,"Make the following request:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"url"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"PROVIDER_HOST/oauth/v2/auth")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"parameters"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_id")," => CLIENT_ID"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"redirect_uri")," => CLIENT_HOST",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"should be identical to the one provided on client creation, otherwise you will get a corresponding error message."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"response_type")," => 'code'"))),(0,o.kt)("p",null,"The page you are requesting will offer you a login, then authorization of the client permissions, once you confirm everything it will redirect you back to the url you provided in redirect_url.\nIn our case, redirect will look like"),(0,o.kt)("pre",null,"CLIENT_HOST/?code=Yjk2MWU5YjVhODBiN2I0ZDRkYmQ1OGM0NGY4MmUyOGM2NDQ2MmY2ZDg2YjUxYjRiMzAwZTY2MDQxZmUzODg2YQ"),(0,o.kt)("p",null,"I\u2019ll refer to this long code parameter as CODE in the future. This code is stored on the Provider side, and once you request for the token, it can uniquely identify the client which made request and the user."),(0,o.kt)("p",null,"It\u2019s time to request the token:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"url"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"PROVIDER_HOST/oauth/v2/token")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"parameters"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_id")," => CLIENT_ID"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_secret")," => CLIENT_SECRET"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"redirect_uri")," => CLIENT_HOST",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"should be identical to the one provided on client creation, otherwise you will get a corresponding error message."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"grant_type")," => authorization_code"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"code")," => CODE"))),(0,o.kt)("p",null,"Most probably this request will fail. That\u2019s because CODE expires rather quickly. Fear not, just request first URL, repeat the process, prepare the second url in the text editor of your choice, copy in the code rather quickly, and you will get the desired result."),(0,o.kt)("p",null,"It\u2019s a JSON which contains access_token and looks like this"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token":"NjlmNDNiZTU4ZDY3ZGFlYTI5MGEzNDcxZWVmZDU4Y2E1NGJmZTJlMjNjNzc2M2E0MmZlZTk2ZjliMWE0MDQyNw",\n    "expires_in":3600,\n    "token_type":"bearer",\n    "scope":null,\n    "refresh_token":"ZGU2NzlhOTQ2MmRlY2YyYjAyMjBkYmJmMmJhMDllNTgyNmJkNmQxOWZlNGQ4NzczY2RiMThlNmRhMjBiYjFjNg"\n}\n')),(0,o.kt)("p",null,"this suggests that access_token expires in 3600 seconds, and to refresh it you have the refresh token. We will discuss how to handle that later on this chapter."),(0,o.kt)("h2",{id:"implicit-grant-flow"},"Implicit Grant flow"),(0,o.kt)("p",null,"It\u2019s similar to Authorization Code grant, it\u2019s just a bit simpler.\nYou just need to make only one request, and you will get the access_token as a part of redirect URL, there\u2019s no need for second response.\nRefresh tokens are not supported in this flow.\nThat\u2019s for the situations where you trust the user and the client, but you still want the user to identify himself in the browser."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"url"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"PROVIDER_HOST/oauth/v2/auth")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"parameters"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_id")," => CLIENT_ID"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"redirect_uri")," => CLIENT_HOST"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"response_type")," => 'token'"))),(0,o.kt)("p",null,"then you will get redirected to"),(0,o.kt)("pre",null,"CLIENT_HOST/#access_token=YWZhZWQ5NjQxOTI2ODJmZWE4YjJiYmExZTIxZmE5OWUxOWZjZjgwZDFlZWMwMjkyZDQwZWU1NWI4YWIzODllNQ&expires_in=3600&token_type=bearer&refresh_token=YzQ1YjRhODk2YzJiYTZmMzNiNjI5ZjI2MDI3ZmMwMDg3MjkxMDdhYmE5YjBlYzRlZmM2M2Q0NTM3ZjFmZDZiYQ"),(0,o.kt)("h2",{id:"password-flow"},"Password flow"),(0,o.kt)("p",null,"Let\u2019s say you have no luxury of redirecting user to some website, then handle redirect call, all you have is just an application which is able to send HTTP requests.\nAnd you still want to somehow authenticate user on the server side, and all you have is username and password."),(0,o.kt)("p",null,"Request:"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"url"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"PROVIDER_HOST/oauth/v2/token")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"parameters"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_id")," => CLIENT_ID"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_secret")," => CLIENT_SECRET"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"grant_type")," => 'password'"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"username")," => USERNAME"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"password")," => PASSWORD"))),(0,o.kt)("p",null,"Response:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token":"MjY1MWRhYTAyZDZlOTEyN2EzNTg4MGMwMTcyYjczY2Y0MWI3NzZjODc1OGM2NDdjODgxZjY3YzEyMDdhZjU0Yg",\n    "expires_in":3600,\n    "token_type":"bearer",\n    "scope":null,\n    "refresh_token":"MDNmNzBmNWQ2NzdhYWVmYjE2NjI3ZjAyZTM4Y2Q1NDRiNDY1YjUyZGE1ZDk0ODZjYmU0MDM0NTQxNjhiZmU3ZA"\n}\n')),(0,o.kt)("h2",{id:"client-credentials-flow"},"Client Credentials flow"),(0,o.kt)("p",null,"This one is the most simplistic flow of them all. You just need to provide CLIENT_ID and CLIENT_SECRET to get back an access token."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"url"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"PROVIDER_HOST/oauth/v2/token")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"parameters"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_id")," => CLIENT_ID"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_secret")," => CLIENT_SECRET"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"grant_type")," => 'client_credentials'"))),(0,o.kt)("p",null,"Response will be"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token":"YTk0YTVjZDY0YWI2ZmE0NjRiODQ4OWIyNjZkNjZlMTdiZGZlNmI3MDNjZGQwYTZkMDNiMjliNDg3NWYwZWI0MQ",\n    "expires_in":3600,\n    "token_type":"bearer",\n    "scope":"user",\n    "refresh_token":"ZDU1MDY1OTc4NGNlNzQ5NWFiYTEzZTE1OGY5MWNjMmViYTBiNmRjOTNlY2ExNzAxNWRmZTM1NjI3ZDkwNDdjNQ"\n}\n')),(0,o.kt)("h2",{id:"refresh-flow"},"Refresh flow"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"access_tokens")," have a lifetime of one hour, after which they will expire.\nWith every ",(0,o.kt)("inlineCode",{parentName:"p"},"access_token")," you were provided a ",(0,o.kt)("inlineCode",{parentName:"p"},"refresh_token"),". You can exchange ",(0,o.kt)("inlineCode",{parentName:"p"},"refresh_token")," and get a new pair of ",(0,o.kt)("inlineCode",{parentName:"p"},"access_token")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"refresh_token"),"."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"url"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"PROVIDER_HOST/oauth/v2/token")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"parameters"),":"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_id")," => CLIENT_ID"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"client_secret")," => CLIENT_SECRET"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"grant_type")," => 'refresh_token'"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"refresh_token")," => REFRESH_TOKEN"))),(0,o.kt)("p",null,"response"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "access_token":NEW_ACCESS_TOKEN,\n    "expires_in":3600,\n    "token_type":"bearer",\n    "scope":"user",\n    "refresh_token":"NEW_REFRESH_TOKEN"\n}\n')))}c.isMDXComponent=!0}}]);